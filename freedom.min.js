/**
 * This is freedom.js. - https://freedomjs.org
 *
 * Copyright 2014 The freedom.js authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * @license apache2.0
 * @see https://freedomjs.org
 * @version 0.6.28
 */
 
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=[{name:"console",api:{log:{type:"method",value:["string","string"]},debug:{type:"method",value:["string","string"]},info:{type:"method",value:["string","string"]},warn:{type:"method",value:["string","string"]},error:{type:"method",value:["string","string"]}}},{name:"core.console",api:{log:{type:"method",value:["string","string"]},debug:{type:"method",value:["string","string"]},info:{type:"method",value:["string","string"]},warn:{type:"method",value:["string","string"]},error:{type:"method",value:["string","string"]}}},{name:"core.crypto",api:{getRandomBytes:{type:"method",value:["number"],ret:"buffer"}}},{name:"core.echo",api:{setup:{type:"method",value:["string"]},send:{type:"method",value:["string"]},message:{type:"event",value:"string"}}},{name:"core",api:{createChannel:{type:"method",value:[],ret:{channel:"proxy",identifier:"string"}},bindChannel:{type:"method",value:["string"],ret:"proxy"},getId:{type:"method",value:[],ret:["array","string"]},getLogger:{type:"method",value:["string"],ret:"proxy"},require:{type:"method",value:["string","string"],ret:"proxy"}}},{name:"core.oauth",api:{initiateOAuth:{type:"method",value:[["array","string"]],ret:{redirect:"string",state:"string"},err:{errcode:"string",message:"string"}},launchAuthFlow:{type:"method",value:["string",{redirect:"string",state:"string"},"boolean"],ret:"string",err:{errcode:"string",message:"string"}}}},{name:"core.peerconnection",api:{setup:{type:"method",value:["string","string",["array","string"],"boolean"]},send:{type:"method",value:[{channelLabel:"string",text:"string",binary:"blob",buffer:"buffer"}]},onReceived:{type:"event",value:{channelLabel:"string",text:"string",binary:"blob",buffer:"buffer"}},openDataChannel:{type:"method",value:["string"]},closeDataChannel:{type:"method",value:["string"]},onOpenDataChannel:{type:"event",value:{channelId:"string"}},onCloseDataChannel:{type:"event",value:{channelId:"string"}},getBufferedAmount:{type:"method",value:["string"],ret:"number"},getInfo:{type:"method",value:[],ret:"string"},createOffer:{type:"method",value:[{offerToReceiveVideo:"number",offerToReceiveAudio:"number",voiceActivityDetection:"boolean",iceRestart:"boolean"}],ret:{type:"string",sdp:"string"}},close:{type:"method",value:[]},onClose:{type:"event",value:{}}}},{name:"core.rtcdatachannel",api:{constructor:{value:["string"]},getLabel:{type:"method",value:[],ret:"string"},getOrdered:{type:"method",value:[],ret:"boolean"},getMaxPacketLifeTime:{type:"method",value:[],ret:"number"},getMaxRetransmits:{type:"method",value:[],ret:"number"},getProtocol:{type:"method",value:[],ret:"string"},getNegotiated:{type:"method",value:[],ret:"boolean"},getId:{type:"method",value:[],ret:"number"},getReadyState:{type:"method",value:[],ret:"string"},getBufferedAmount:{type:"method",value:[],ret:"number"},onopen:{type:"event",value:[]},onerror:{type:"event",value:[]},onclose:{type:"event",value:[]},close:{type:"method",value:[]},onmessage:{type:"event",value:{text:"string",buffer:"buffer"}},getBinaryType:{type:"method",value:[],ret:"string"},setBinaryType:{type:"method",value:["string"]},send:{type:"method",value:["string"]},sendBuffer:{type:"method",value:["buffer"]}}},{name:"core.rtcpeerconnection",api:{constructor:{value:[{iceServers:["array",{urls:["array","string"],username:"string",credential:"string"}],iceTransports:"string",peerIdentity:"string"}]},createOffer:{type:"method",value:[{offerToReceiveAudio:"number",offerToReceiveVideo:"number",iceRestart:"boolean",voiceActivityDetection:"boolean"}],ret:{type:"string",sdp:"string"}},createAnswer:{type:"method",value:[],ret:{type:"string",sdp:"string"}},setLocalDescription:{type:"method",value:[{type:"string",sdp:"string"}]},getLocalDescription:{type:"method",value:[],ret:{type:"string",sdp:"string"}},setRemoteDescription:{type:"method",value:[{type:"string",sdp:"string"}],ret:{}},getRemoteDescription:{type:"method",value:[],ret:{type:"string",sdp:"string"}},getSignalingState:{type:"method",value:[],ret:"string"},updateIce:{type:"method",value:[{iceServers:["array",{urls:["array","string"],username:"string",credential:"string"}],iceTransports:"string",peerIdentity:"string"}],ret:{}},addIceCandidate:{type:"method",value:[{candidate:"string",sdpMid:"string",sdpMLineIndex:"number"}],ret:{}},getIceGatheringState:{type:"method",value:[],ret:"string"},getIceConnectionState:{type:"method",value:[],ret:"string"},getConfiguration:{type:"method",value:[],ret:{iceServers:["array",{urls:["array","string"],username:"string",credential:"string"}],iceTransports:"string",peerIdentity:"string"}},getLocalStreams:{type:"method",value:[],ret:["array","string"]},getRemoteStreams:{type:"method",value:[],ret:["array","string"]},getStreamById:{type:"method",value:["string"],ret:"string"},addStream:{type:"method",value:["string"],ret:{}},removeStream:{type:"method",value:["string"],ret:{}},close:{type:"method",value:[],ret:{}},createDataChannel:{type:"method",value:["string",{ordered:"boolean",maxPacketLifeTime:"number",maxRetransmits:"number",protocol:"string",negotiated:"boolean",id:"number"}],ret:"string"},ondatachannel:{type:"event",value:{channel:"string"}},getStats:{type:"method",value:["string"],ret:"object"},onnegotiationneeded:{type:"event",value:[]},onicecandidate:{type:"event",value:{candidate:{candidate:"string",sdpMid:"string",sdpMLineIndex:"number"}}},onsignalingstatechange:{type:"event",value:[]},onaddstream:{type:"event",value:{stream:"number"}},onremovestream:{type:"event",value:{stream:"number"}},oniceconnectionstatechange:{type:"event",value:[]}}},{name:"core.storage",api:{keys:{type:"method",value:[],ret:["array","string"]},get:{type:"method",value:["string"],ret:"string"},set:{type:"method",value:["string","string"],ret:"string"},remove:{type:"method",value:["string"],ret:"string"},clear:{type:"method",value:[]}}},{name:"core.tcpsocket",api:{constructor:{value:["number"]},getInfo:{type:"method",value:[],ret:{connected:"boolean",localAddress:"string",localPort:"number",peerAddress:"string",peerPort:"number"}},ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",ALREADY_CONNECTED:"Socket already connected",INVALID_ARGUMENT:"Invalid argument",TIMED_OUT:"Timed out",NOT_CONNECTED:"Socket not connected",NETWORK_CHANGED:"Network changed",CONNECTION_CLOSED:"Connection closed gracefully",CONNECTION_RESET:"Connection reset",CONNECTION_REFUSED:"Connection refused",CONNECTION_FAILED:"Connection failed",NAME_NOT_RESOLVED:"DNS lookup failed",INTERNET_DISCONNECTED:"Cannot reach any network",ADDRESS_INVALID:"Invalid address",ADDRESS_UNREACHABLE:"No route to host",HOST_UNREACHABLE:"SOCKS proxy server could not reach host"}},close:{type:"method",value:[],err:{errcode:"string",message:"string"}},onDisconnect:{type:"event",value:{errcode:"string",message:"string"}},connect:{type:"method",value:["string","number"],err:{errcode:"string",message:"string"}},secure:{type:"method",value:[],err:{errcode:"string",message:"string"}},pause:{type:"method",value:[],err:{errcode:"string",message:"string"}},resume:{type:"method",value:[],err:{errcode:"string",message:"string"}},prepareSecure:{type:"method",value:[],err:{errcode:"string",message:"string"}},write:{type:"method",value:["buffer"],err:{errcode:"string",message:"string"}},onData:{type:"event",value:{data:"buffer"}},listen:{type:"method",value:["string","number"],err:{errcode:"string",message:"string"}},onConnection:{type:"event",value:{socket:"number",host:"string",port:"number"}}}},{name:"core.udpsocket",api:{ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",ALREADY_BOUND:"Socket already bound",ALREADY_CLOSED:"Socket already closed",INVALID_ARGUMENT:"Invalid argument",NETWORK_CHANGED:"Network changed",SEND_FAILED:"Send failed"}},bind:{type:"method",value:["string","number"],ret:[],err:{errcode:"string",message:"string"}},getInfo:{type:"method",value:[],ret:{localAddress:"string",localPort:"number"}},sendTo:{type:"method",value:["buffer","string","number"],ret:"number",err:{errcode:"string",message:"string"}},destroy:{type:"method",value:[]},onData:{type:"event",value:{resultCode:"number",address:"string",port:"number",data:"buffer"}}}},{name:"core.view",api:{show:{type:"method",value:["string"]},isSecure:{type:"method",value:[],ret:"boolean"},close:{type:"method",value:[]},postMessage:{type:"method",value:["object"]},message:{type:"event",value:"object"},onClose:{type:"event",value:[]}}},{name:"core.websocket",api:{constructor:{value:["string",["array","string"]]},send:{type:"method",value:[{text:"string",binary:"blob",buffer:"buffer"}],err:{errcode:"string",message:"string"}},getReadyState:{type:"method",value:[],ret:"number"},getBufferedAmount:{type:"method",value:["string"],ret:"number"},close:{type:"method",value:["number","string"],err:{errcode:"string",message:"string"}},onMessage:{type:"event",value:{text:"string",binary:"blob",buffer:"buffer"}},onOpen:{type:"event",value:[]},onError:{type:"event",value:{errcode:"string",message:"string"}},onClose:{type:"event",value:{code:"number",reason:"string",wasClean:"boolean"}}}},{name:"core.xhr",api:{open:{type:"method",value:["string","string","boolean","string","string"],err:{errcode:"string",message:"string"}},send:{type:"method",value:[{string:"string",buffer:"buffer",blob:"blob"}]},abort:{type:"method",value:[]},getResponseHeader:{type:"method",value:["string"],ret:"string"},getAllResponseHeaders:{type:"method",value:[],ret:"string"},setRequestHeader:{type:"method",value:["string","string"]},overrideMimeType:{type:"method",value:["string"]},getReadyState:{type:"method",value:[],ret:"number"},getResponse:{type:"method",value:[],ret:{string:"string",buffer:"buffer",object:"object"}},getResponseText:{type:"method",value:[],ret:"string"},getResponseURL:{type:"method",value:[],ret:"string"},getResponseType:{type:"method",value:[],ret:"string"},setResponseType:{type:"method",value:["string"]},getStatus:{type:"method",value:[],ret:"number"},getStatusText:{type:"method",value:[],ret:"string"},getTimeout:{type:"method",value:[],ret:"number"},setTimeout:{type:"method",value:["number"]},getWithCredentials:{type:"method",value:[],ret:"boolean"},setWithCredentials:{type:"method",value:["boolean"]},onloadstart:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onprogress:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onabort:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onerror:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onload:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},ontimeout:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onloadend:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onreadystatechange:{type:"event",value:{}},onuploadloadstart:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadprogress:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadabort:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploaderror:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadload:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadtimeout:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadloadend:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadreadystatechange:{type:"event",value:{}}}},{name:"social",api:{ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",OFFLINE:"User is currently offline",MALFORMEDPARAMETERS:"Parameters are malformed",LOGIN_BADCREDENTIALS:"Error authenticating with server",LOGIN_FAILEDCONNECTION:"Error connecting to server",LOGIN_ALREADYONLINE:"User is already logged in",LOGIN_OAUTHERROR:"OAuth Error",SEND_INVALIDDESTINATION:"Message sent to an invalid destination"}},STATUS:{type:"constant",value:{OFFLINE:"OFFLINE",ONLINE:"ONLINE",ONLINE_WITH_OTHER_APP:"ONLINE_WITH_OTHER_APP"}},login:{type:"method",value:[{agent:"string",version:"string",url:"string",interactive:"boolean",rememberLogin:"boolean"}],ret:{userId:"string",clientId:"string",status:"string",lastUpdated:"number",lastSeen:"number"},err:{errcode:"string",message:"string"}},clearCachedCredentials:{type:"method",value:[]},getClients:{type:"method",value:[],ret:"object",err:{errcode:"string",message:"string"}},getUsers:{type:"method",value:[],ret:"object",err:{errcode:"string",message:"string"}},sendMessage:{type:"method",value:["string","string"],err:{errcode:"string",message:"string"}},logout:{type:"method",value:[],err:{errcode:"string",message:"string"}},onMessage:{type:"event",value:{from:{userId:"string",clientId:"string",status:"string",lastUpdated:"number",lastSeen:"number"},message:"string"}},onUserProfile:{type:"event",value:{userId:"string",lastUpdated:"number",name:"string",url:"string",imageData:"string"}},onClientState:{type:"event",value:{userId:"string",clientId:"string",status:"string",lastUpdated:"number",lastSeen:"number"}}}},{name:"storage",api:{scope:{type:"constant",value:{SESSION:0,DEVICE_LOCAL:1,USER_LOCAL:2,SHARED:3}},ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",OFFLINE:"Database not reachable",MALFORMEDPARAMETERS:"Parameters are malformed"}},constructor:{value:[{scope:"number"}]},keys:{type:"method",value:[],ret:["array","string"],err:{errcode:"string",message:"string"}},get:{type:"method",value:["string"],ret:"string",err:{errcode:"string",message:"string"}},set:{type:"method",value:["string","string"],ret:"string",err:{errcode:"string",message:"string"}},remove:{type:"method",value:["string"],ret:"string",err:{errcode:"string",message:"string"}},clear:{type:"method",value:[],ret:[],err:{errcode:"string",message:"string"}}}},{name:"storebuffer",api:{scope:{type:"constant",value:{SESSION:0,DEVICE_LOCAL:1,USER_LOCAL:2,SHARED:3}},ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",OFFLINE:"Database not reachable",MALFORMEDPARAMETERS:"Parameters are malformed"}},constructor:{value:[{scope:"number"}]},keys:{type:"method",value:[],ret:["array","string"],err:{errcode:"string",message:"string"}},get:{type:"method",value:["string"],ret:"buffer",err:{errcode:"string",message:"string"}},set:{type:"method",value:["string","buffer"],ret:"buffer",err:{errcode:"string",message:"string"}},remove:{type:"method",value:["string"],ret:"buffer",err:{errcode:"string",message:"string"}},clear:{type:"method",value:[],ret:[],err:{errcode:"string",message:"string"}}}},{name:"transport",api:{ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",OFFLINE:"Not reachable",MALFORMEDPARAMETERS:"Parameters are malformed"}},setup:{type:"method",value:["string","proxy"],ret:[],err:{errcode:"string",message:"string"}},send:{type:"method",value:["string","buffer"],ret:[],err:{errcode:"string",message:"string"}},close:{type:"method",value:[],ret:[],err:{errcode:"string",message:"string"}},onData:{type:"event",value:{tag:"string",data:"buffer"}},onClose:{type:"event",value:[]}}}]},{}],2:[function(a,b,c){(function(c,d){(function(){"use strict";function e(a){return"function"==typeof a||"object"==typeof a&&null!==a}function f(a){return"function"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){T=a}function i(a){X=a}function j(){return function(){c.nextTick(o)}}function k(){return function(){S(o)}}function l(){var a=0,b=new $(o),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function m(){var a=new MessageChannel;return a.port1.onmessage=o,function(){a.port2.postMessage(0)}}function n(){return function(){setTimeout(o,1)}}function o(){for(var a=0;W>a;a+=2){var b=ba[a],c=ba[a+1];b(c),ba[a]=void 0,ba[a+1]=void 0}W=0}function p(){try{var b=a,c=b("vertx");return S=c.runOnLoop||c.runOnContext,k()}catch(d){return n()}}function q(){}function r(){return new TypeError("You cannot resolve a promise with itself")}function s(){return new TypeError("A promises callback cannot return that same promise.")}function t(a){try{return a.then}catch(b){return fa.error=b,fa}}function u(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function v(a,b,c){X(function(a){var d=!1,e=u(c,b,function(c){d||(d=!0,b!==c?y(a,c):A(a,c))},function(b){d||(d=!0,B(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,B(a,e))},a)}function w(a,b){b._state===da?A(a,b._result):b._state===ea?B(a,b._result):C(b,void 0,function(b){y(a,b)},function(b){B(a,b)})}function x(a,b){if(b.constructor===a.constructor)w(a,b);else{var c=t(b);c===fa?B(a,fa.error):void 0===c?A(a,b):f(c)?v(a,b,c):A(a,b)}}function y(a,b){a===b?B(a,r()):e(b)?x(a,b):A(a,b)}function z(a){a._onerror&&a._onerror(a._result),D(a)}function A(a,b){a._state===ca&&(a._result=b,a._state=da,0!==a._subscribers.length&&X(D,a))}function B(a,b){a._state===ca&&(a._state=ea,a._result=b,X(z,a))}function C(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+da]=c,e[f+ea]=d,0===f&&a._state&&X(D,a)}function D(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?G(c,d,e,f):e(f);a._subscribers.length=0}}function E(){this.error=null}function F(a,b){try{return a(b)}catch(c){return ga.error=c,ga}}function G(a,b,c,d){var e,g,h,i,j=f(c);if(j){if(e=F(c,d),e===ga?(i=!0,g=e.error,e=null):h=!0,b===e)return void B(b,s())}else e=d,h=!0;b._state!==ca||(j&&h?y(b,e):i?B(b,g):a===da?A(b,e):a===ea&&B(b,e))}function H(a,b){try{b(function(b){y(a,b)},function(b){B(a,b)})}catch(c){B(a,c)}}function I(a,b){var c=this;c._instanceConstructor=a,c.promise=new a(q),c._validateInput(b)?(c._input=b,c.length=b.length,c._remaining=b.length,c._init(),0===c.length?A(c.promise,c._result):(c.length=c.length||0,c._enumerate(),0===c._remaining&&A(c.promise,c._result))):B(c.promise,c._validationError())}function J(a){return new ha(this,a).promise}function K(a){function b(a){y(e,a)}function c(a){B(e,a)}var d=this,e=new d(q);if(!V(a))return B(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;e._state===ca&&f>g;g++)C(d.resolve(a[g]),void 0,b,c);return e}function L(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(q);return y(c,a),c}function M(a){var b=this,c=new b(q);return B(c,a),c}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function O(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function P(a){this._id=ma++,this._state=void 0,this._result=void 0,this._subscribers=[],q!==a&&(f(a)||N(),this instanceof P||O(),H(this,a))}function Q(){var a;if("undefined"!=typeof d)a=d;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw new Error("polyfill failed because global object is unavailable in this environment")}var c=a.Promise;(!c||"[object Promise]"!==Object.prototype.toString.call(c.resolve())||c.cast)&&(a.Promise=na)}var R;R=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var S,T,U,V=R,W=0,X=({}.toString,function(a,b){ba[W]=a,ba[W+1]=b,W+=2,2===W&&(T?T(o):U())}),Y="undefined"!=typeof window?window:void 0,Z=Y||{},$=Z.MutationObserver||Z.WebKitMutationObserver,_="undefined"!=typeof c&&"[object process]"==={}.toString.call(c),aa="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ba=new Array(1e3);U=_?j():$?l():aa?m():void 0===Y&&"function"==typeof a?p():n();var ca=void 0,da=1,ea=2,fa=new E,ga=new E;I.prototype._validateInput=function(a){return V(a)},I.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},I.prototype._init=function(){this._result=new Array(this.length)};var ha=I;I.prototype._enumerate=function(){for(var a=this,b=a.length,c=a.promise,d=a._input,e=0;c._state===ca&&b>e;e++)a._eachEntry(d[e],e)},I.prototype._eachEntry=function(a,b){var c=this,d=c._instanceConstructor;g(a)?a.constructor===d&&a._state!==ca?(a._onerror=null,c._settledAt(a._state,b,a._result)):c._willSettleAt(d.resolve(a),b):(c._remaining--,c._result[b]=a)},I.prototype._settledAt=function(a,b,c){var d=this,e=d.promise;e._state===ca&&(d._remaining--,a===ea?B(e,c):d._result[b]=c),0===d._remaining&&A(e,d._result)},I.prototype._willSettleAt=function(a,b){var c=this;C(a,void 0,function(a){c._settledAt(da,b,a)},function(a){c._settledAt(ea,b,a)})};var ia=J,ja=K,ka=L,la=M,ma=0,na=P;P.all=ia,P.race=ja,P.resolve=ka,P.reject=la,P._setScheduler=h,P._setAsap=i,P._asap=X,P.prototype={constructor:P,then:function(a,b){var c=this,d=c._state;if(d===da&&!a||d===ea&&!b)return this;var e=new this.constructor(q),f=c._result;if(d){var g=arguments[d-1];X(function(){G(d,e,g,f)})}else C(c,e,a,b);return e},"catch":function(a){return this.then(null,a)}};var oa=Q,pa={Promise:na,polyfill:oa};"function"==typeof define&&define.amd?define(function(){return pa}):"undefined"!=typeof b&&b.exports?b.exports=pa:"undefined"!=typeof this&&(this.ES6Promise=pa),oa()}).call(this)}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],3:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],4:[function(a,b,c){"use strict";var d=null,e=null,f=null,g=function(a){return a?a.iceServers?(a.iceServers.forEach(function(a){a.url=a.urls,delete a.urls}),a):a:void 0},h=function(a){var b={},c=a.result();return c.forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},i=function(a){var b={};return a.forEach(function(a){b[a.id]=a}),b},j=function(a){if(!a)return!1;var b=!1,c="m=application";return a.sdp.split("\n").forEach(function(a){a.slice(0,c.length)===c&&(b=!0)}),b};"undefined"!=typeof RTCPeerConnection?d=RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?d=function(a,b){var c=new mozRTCPeerConnection(g(a),b),d=c.getStats.bind(c);c.getStats=function(a,b,c){var e=function(a){b(i(a))};d(a,e,c)};var e=!1,f=c.createDataChannel.bind(c);return c.createDataChannel=function(a,b){var d=f(a,b);if(!e&&(e=!0,c.onnegotiationneeded&&!j(c.localDescription)&&!j(c.remoteDescription))){var g=new Event("negotiationneeded");c.onnegotiationneeded(g)}return d},c}:"undefined"!=typeof webkitRTCPeerConnection&&(d=function(a,b){var c=new webkitRTCPeerConnection(a,b),d=c.getStats.bind(c);return c.getStats=function(a,b,c){var e=function(a){b(h(a))};d(e,c,a)},c}),"undefined"!=typeof RTCSessionDescription?e=RTCSessionDescription:"undefined"!=typeof mozRTCSessionDescription&&(e=mozRTCSessionDescription),"undefined"!=typeof RTCIceCandidate?f=RTCIceCandidate:"undefined"!=typeof mozRTCIceCandidate&&(f=mozRTCIceCandidate),c.RTCPeerConnection=d,c.RTCSessionDescription=e,c.RTCIceCandidate=f},{}],5:[function(a,b,c){(function(b){var d=a("../../src/util"),e=function(a){this.level=a.config&&a.config.debug||"log",this.console=a.config&&a.config.global.console,d.handleEvents(this)};e.level={debug:0,info:1,log:2,warn:3,error:4},e.prototype.print=function(a,c,d){var f=d;"undefined"!=typeof this.console&&this.console.freedom!==!0&&("string"==typeof f&&(f=[f]),void 0!==e.level[this.level]&&e.level[a]<e.level[this.level]||(c&&("undefined"!=typeof b&&"[object process]"==={}.toString.call(b)?(f.unshift("[39m"),f.unshift("[31m"+c)):this.console.maxLogLevel?(this.console.freedomDump||(this.console.freedomDump=this.console.dump,this.console.dump=function(){}),this.console.freedomDump(c+" "+a[0].toUpperCase()+" "+f.join(" ")+"\n")):(f.unshift("color: none"),f.unshift("color: red"),f.unshift("%c"+c+"%c"))),!this.console[a]&&this.console.log&&(a="log"),this.console[a].apply(this.console,f)))},e.prototype.log=function(a,b,c){this.print("log",a,b),c()},e.prototype.debug=function(a,b,c){this.print("debug",a,b),c()},e.prototype.info=function(a,b,c){this.print("info",a,b),c()},e.prototype.warn=function(a,b,c){this.print("warn",a,b),c()},e.prototype.error=function(a,b,c){this.print("error",a,b),c()},c.provider=e,c.name="core.console",c.flags={config:!0}}).call(this,a("_process"))},{"../../src/util":36,_process:3}],6:[function(a,b,c){var d=a("../../src/util"),e=function(a,b){"use strict";this.dispatchEvent=b,d.handleEvents(this)};e.prototype.getRandomBytes=function(a,b){"use strict";var c=new Uint8Array(a);crypto.getRandomValues(c),b(c.buffer)},c.provider=e,c.name="core.crypto"},{"../../src/util":36}],7:[function(a,b,c){var d=a("../../src/util"),e=function(a,b){this.mod=a.module,this.dispatchEvent=b,d.handleEvents(this),this.mod.once("core",function(a){this.core=new a}.bind(this)),this.mod.emit(this.mod.controlChannel,{type:"core request delegated to echo",request:"core"})};e.prototype.setup=function(a,b){return b(),this.core?void this.core.bindChannel(a,function(a){this.chan&&this.chan.close(),this.chan=a,this.chan.onClose(function(){delete this.chan}.bind(this)),this.dispatchEvent("message","channel bound to echo"),this.chan.on("message",function(a){this.dispatchEvent("message","from custom channel: "+a)}.bind(this))}.bind(this)):void this.dispatchEvent("message","no core available to setup proxy with at echo")},e.prototype.send=function(a,b){b(),this.chan?this.chan.emit("message",a):this.dispatchEvent("message","no channel available")},c.provider=e,c.name="core.echo",c.flags={module:!0}},{"../../src/util":36}],8:[function(a,b,c){var d=function(a,b,c){this.handlers=a,this.dispatchEvent=c,this.ongoing={}};d.register=function(a){var b,e=[];if(!a||!a.length)return d.reset();for(b=0;b<a.length;b+=1)e.push(new a[b]);c.provider=d.bind(this,e)},d.reset=function(){c.provider=d.bind(this,[])},d.prototype.initiateOAuth=function(a,b){var c,d;for(d=function(a){this.ongoing[a.state]=this.handlers[c],b(a)}.bind(this),c=0;c<this.handlers.length;c+=1)if(this.handlers[c].initiateOAuth(a,d))return;b(null,{errcode:"UNKNOWN",message:"No requested redirects can be handled."})},d.prototype.launchAuthFlow=function(a,b,c,d){return this.ongoing.hasOwnProperty(b.state)?(void 0===c&&(c=!0),this.ongoing[b.state].launchAuthFlow(a,b,c,d),void delete this.ongoing[b.state]):void d(void 0,{errcode:"UNKNOWN",message:"You must begin the oAuth flow with initiateOAuth first"})},c.register=d.register,c.reset=d.reset,c.provider=d.bind(this,[]),c.name="core.oauth"},{}],9:[function(a,b,c){function d(a,b,c,d){var e,g,h;if(this.peerName=a,this.channels={},this.dataChannelCallbacks=c,this.onConnectedQueue=[],"undefined"!=typeof d.RTCPeerConnection)this.RTCPeerConnection=d.RTCPeerConnection;else if("undefined"!=typeof webkitRTCPeerConnection)this.RTCPeerConnection=webkitRTCPeerConnection;else{if("undefined"==typeof mozRTCPeerConnection)throw new Error("This environment does not appear to support RTCPeerConnection");this.RTCPeerConnection=mozRTCPeerConnection}if("undefined"!=typeof d.RTCSessionDescription)this.RTCSessionDescription=d.RTCSessionDescription;else if("undefined"!=typeof RTCSessionDescription)this.RTCSessionDescription=RTCSessionDescription;else{if("undefined"==typeof mozRTCSessionDescription)throw new Error("This environment does not appear to support RTCSessionDescription");this.RTCSessionDescription=mozRTCSessionDescription}if("undefined"!=typeof d.RTCIceCandidate)this.RTCIceCandidate=d.RTCIceCandidate;else if("undefined"!=typeof RTCIceCandidate)this.RTCIceCandidate=RTCIceCandidate;else{if("undefined"==typeof mozRTCIceCandidate)throw new Error("This environment does not appear to support RTCIceCandidate");this.RTCIceCandidate=mozRTCIceCandidate}for(e={optional:[{DtlsSrtpKeyAgreement:!0}]},this.sendSignalMessage=null,this.pc=null,g={iceServers:[]},h=0;h<b.length;h+=1)g.iceServers.push({url:b[h]});this.pc=new this.RTCPeerConnection(g,e),this.pc.addEventListener("icecandidate",this.onIceCallback.bind(this)),this.pc.addEventListener("negotiationneeded",this.onNegotiationNeeded.bind(this)),this.pc.addEventListener("datachannel",this.onDataChannel.bind(this)),this.pc.addEventListener("signalingstatechange",function(){"stable"===this.pc.signalingState&&(this.pcState=f.CONNECTED,this.onConnectedQueue.map(function(a){a()}))}.bind(this)),this.pcState=f.DISCONNECTED}function e(a,b,c,d,e){this.dispatchEvent=b,this.peerName="p"+Math.random(),this.freedomModule=a.module,this.RTCPeerConnection=c,this.RTCSessionDescription=d,this.RTCIceCandidate=e,this.signallingChannel=null,this.peer=null,this.freedomModule.once("core",function(a){this.core=new a}.bind(this)),this.freedomModule.emit(this.freedomModule.controlChannel,{type:"core request delegated to peerconnection",request:"core"})}var f={DISCONNECTED:"DISCONNECTED",CONNECTING:"CONNECTING",CONNECTED:"CONNECTED"};d.prototype.createOffer=function(a,b){this.pc.createOffer(b,function(){console.error("core.peerconnection createOffer failed.")},a)},d.prototype.runWhenConnected=function(a){this.pcState===f.CONNECTED?a():this.onConnectedQueue.push(a)},d.prototype.send=function(a,b,c){this.channels[a].send(b),c()},d.prototype.openDataChannel=function(a,b){var c=this.pc.createDataChannel(a,{});c.onopen=function(){this.addDataChannel(a,c),b()}.bind(this),c.onerror=function(a){console.error(a),b(void 0,a)},"undefined"!=typeof mozRTCPeerConnection&&this.pcState===f.DISCONNECTED&&this.negotiateConnection()},d.prototype.closeChannel=function(a){void 0!==this.channels[a]&&(this.channels[a].close(),delete this.channels[a])},d.prototype.getBufferedAmount=function(a,b){if(void 0!==this.channels[a]){var c=this.channels[a];return c.bufferedAmount}throw new Error("No channel with id: "+a)},d.prototype.setSendSignalMessage=function(a){this.sendSignalMessage=a},d.prototype.handleSignalMessage=function(a){var b,c=JSON.parse(a);c.sdp?this.pc.setRemoteDescription(new this.RTCSessionDescription(c.sdp),function(){"offer"===this.pc.remoteDescription.type&&this.pc.createAnswer(this.onDescription.bind(this),console.error)}.bind(this),function(a){console.error(this.peerName+": setRemoteDescription failed:",a)}.bind(this)):c.candidate?(b=new this.RTCIceCandidate(c.candidate),this.pc.addIceCandidate(b)):console.warn(this.peerName+": handleSignalMessage got unexpected message: ",a)},d.prototype.negotiateConnection=function(){this.pcState=f.CONNECTING,this.pc.createOffer(this.onDescription.bind(this),function(a){console.error(this.peerName+": createOffer failed: ",a.toString()),this.pcState=f.DISCONNECTED}.bind(this))},d.prototype.isClosed=function(){return!this.pc||"closed"===this.pc.signalingState;
},d.prototype.close=function(){this.isClosed()||this.pc.close()},d.prototype.addDataChannel=function(a,b){var c=this.dataChannelCallbacks;this.channels[a]=b,"connecting"===b.readyState&&(b.onopen=c.onOpenFn.bind(this,b,{label:a})),b.onclose=c.onCloseFn.bind(this,b,{label:a}),b.onmessage=c.onMessageFn.bind(this,b,{label:a}),b.onerror=c.onErrorFn.bind(this,b,{label:b})},d.prototype.onDescription=function(a){this.sendSignalMessage?this.pc.setLocalDescription(a,function(){this.sendSignalMessage(JSON.stringify({sdp:a}))}.bind(this),function(a){console.error(this.peerName+": setLocalDescription failed:",a)}.bind(this)):console.error(this.peerName+": _onDescription: _sendSignalMessage is not set, so we did not set the local description. ")},d.prototype.onNegotiationNeeded=function(a){if(this.pcState!==f.DISCONNECTED){var b=function(a){return function(){}.bind(this)}.bind(this),c=function(a){return function(a){}.bind(this)}.bind(this);return void(this.pc.localDescription&&this.pc.remoteDescription&&"offer"===this.pc.localDescription.type?(this.pc.setLocalDescription(this.pc.localDescription,b("setLocalDescription"),c("setLocalDescription")),this.pc.setRemoteDescription(this.pc.remoteDescription,b("setRemoteDescription"),c("setRemoteDescription"))):this.pc.localDescription&&this.pc.remoteDescription&&"answer"===this.pc.localDescription.type?(this.pc.setRemoteDescription(this.pc.remoteDescription,b("setRemoteDescription"),c("setRemoteDescription")),this.pc.setLocalDescription(this.pc.localDescription,b("setLocalDescription"),c("setLocalDescription"))):console.error(this.peerName+", onNegotiationNeeded failed"))}this.negotiateConnection()},d.prototype.onIceCallback=function(a){a.candidate&&(this.sendSignalMessage?this.sendSignalMessage(JSON.stringify({candidate:a.candidate})):console.warn(this.peerName+": _onDescription: _sendSignalMessage is not set."))},d.prototype.onSignalingStateChange=function(){"stable"===this.pc.signalingState&&(this.pcState=f.CONNECTED,this.onConnectedQueue.map(function(a){a()}))},d.prototype.onDataChannel=function(a){this.addDataChannel(a.channel.label,a.channel),"open"===a.channel.readyState&&this.dataChannelCallbacks.onOpenFn(a.channel,{label:a.channel.label})},e.prototype.setup=function(a,b,c,e,f){this.peerName=b;var g,h,i={RTCPeerConnection:this.RTCPeerConnection,RTCSessionDescription:this.RTCSessionDescription,RTCIceCandidate:this.RTCIceCandidate},j=this,k={onOpenFn:function(a,b){j.dispatchEvent("onOpenDataChannel",{channelId:b.label})},onCloseFn:function(a,b){j.dispatchEvent("onCloseDataChannel",{channelId:b.label})},onMessageFn:function(a,b,c){c.data instanceof ArrayBuffer?j.dispatchEvent("onReceived",{channelLabel:b.label,buffer:c.data}):c.data instanceof Blob?j.dispatchEvent("onReceived",{channelLabel:b.label,binary:c.data}):"string"==typeof c.data&&j.dispatchEvent("onReceived",{channelLabel:b.label,text:c.data})},onErrorFn:function(a,b,c){console.error(a.peerName+": dataChannel("+a.dataChannel.label+"): error: ",c)}};this.peer=new d(this.peerName,c,k,i),this.core.bindChannel(a,function(a){this.signallingChannel=a,this.peer.setSendSignalMessage(function(a){this.signallingChannel.emit("message",a)}.bind(this)),this.signallingChannel.on("message",this.peer.handleSignalMessage.bind(this.peer)),this.signallingChannel.emit("ready"),e||this.peer.runWhenConnected(f)}.bind(this)),e&&(console.log(this.peerName+" initiating connection"),g="hello"+Math.random().toString(),h=function(a,b){b?f(void 0,b):this.closeDataChannel(g,f)}.bind(this),this.openDataChannel(g,h))},e.prototype.createOffer=function(a,b){this.peer.createOffer(a,b)},e.prototype.openDataChannel=function(a,b){this.peer.openDataChannel(a,b)},e.prototype.closeDataChannel=function(a,b){this.peer.closeChannel(a),b()},e.prototype.send=function(a,b){var c=a.text||a.buffer||a.binary;return"undefined"==typeof c?void console.error("No valid data to send has been provided.",a):void this.peer.send(a.channelLabel,c,b)},e.prototype.getBufferedAmount=function(a,b){b(this.peer.getBufferedAmount(a))},e.prototype.close=function(a){return this.peer.isClosed()?void a():(this.peer.close(),this.dispatchEvent("onClose"),void a())},c.provider=e,c.name="core.peerconnection",c.flags={module:!0}},{}],10:[function(a,b,c){var d=a("../../src/util"),e=["onopen","onerror","onclose","onmessage"],f={},g={},h=function(a){var b=d.getId();return f[b]=a,g[b]=[],e.forEach(function(c){var d=function(e){var f=a[c];if(f===d)g[b].push(e);else{if("function"!=typeof f)throw new Error("No handler for "+e.type+" event");f(e)}};a[c]=d}),b},i=function(b,c,d){if(this.dispatchEvent=c,!f[d]){console.warn("Invalid ID, creating acting on unattached DataChannel");var e=a("./core.rtcpeerconnection").provider,g=new e;d=g.createDataChannel(),g.close()}this.channel=f[d],delete f[d],setTimeout(function(){this.drainPendingEvents(d),this.manageEvents(!0)}.bind(this),0)};i.prototype.drainPendingEvents=function(a){g[a].forEach(function(a){this["on"+a.type](a)}.bind(this)),delete g[a]},i.prototype.manageEvents=function(a){e.forEach(function(b){a?(this[b]=this[b].bind(this),this.channel[b]=this[b]):delete this.channel[b]}.bind(this))},i.prototype.getLabel=function(a){a(this.channel.label)},i.prototype.getOrdered=function(a){a(this.channel.ordered)},i.prototype.getMaxPacketLifeTime=function(a){a(this.channel.maxPacketLifeTime)},i.prototype.getMaxRetransmits=function(a){a(this.channel.maxRetransmits)},i.prototype.getProtocol=function(a){a(this.channel.protocol)},i.prototype.getNegotiated=function(a){a(this.channel.negotiated)},i.prototype.getId=function(a){a(this.channel.id)},i.prototype.getReadyState=function(a){a(this.channel.readyState)},i.prototype.getBufferedAmount=function(a){a(this.channel.bufferedAmount)},i.prototype.getBinaryType=function(a){a(this.channel.binaryType)},i.prototype.setBinaryType=function(a,b){this.channel.binaryType=a,b()},i.prototype.send=function(a,b){this.channel.send(a),b()},i.prototype.sendBuffer=function(a,b){this.channel.send(a),b()},i.prototype.close=function(a){return this.channel?(this.manageEvents(!1),this.channel.close(),void a()):a()},i.prototype.onopen=function(a){this.dispatchEvent("onopen",a.message)},i.prototype.onerror=function(a){this.dispatchEvent("onerror",{errcode:a.type,message:a.message})},i.prototype.onclose=function(a){this.dispatchEvent("onclose",a.message)},i.prototype.onmessage=function(a){if("string"==typeof a.data)this.dispatchEvent("onmessage",{text:a.data});else if("arraybuffer"!==this.channel.binaryType||"undefined"==typeof Components||a.data instanceof ArrayBuffer)this.dispatchEvent("onmessage",{buffer:a.data});else{var b=Components.utils.cloneInto(a.data,{});this.dispatchEvent("onmessage",{buffer:b})}},c.name="core.rtcdatachannel",c.provider=i,c.allocate=h},{"../../src/util":36,"./core.rtcpeerconnection":11}],11:[function(a,b,c){var d=a("webrtc-adapter"),e=a("es6-promise").Promise,f=d.RTCPeerConnection,g=d.RTCSessionDescription,h=d.RTCIceCandidate,i=a("./core.rtcdatachannel"),j=function(a,b,c){this.dispatchEvent=b;try{this.connection=new f(c)}catch(d){return void setTimeout(a.provider.close.bind(a.provider,this),0)}this.events=["ondatachannel","onnegotiationneeded","onicecandidate","onsignalingstatechange","onaddstream","onremovestream","oniceconnectionstatechange"],this.manageEvents(!0)};j.prototype.manageEvents=function(a){this.events.forEach(function(b){a?(this[b]=this[b].bind(this),this.connection[b]=this[b]):this.connection&&delete this.connection[b]}.bind(this))},j.prototype.createOffer=function(a){return new e(function(b,c){this.connection.createOffer(b,c,a)}.bind(this))},j.prototype.createAnswer=function(){return new e(function(a,b){this.connection.createAnswer(a,b)}.bind(this))},j.prototype.setLocalDescription=function(a){return new e(function(b,c){this.connection.setLocalDescription(new g(a),b,c)}.bind(this))},j.prototype.getLocalDescription=function(){return e.resolve(this.connection.localDescription)},j.prototype.setRemoteDescription=function(a){return new e(function(b,c){this.connection.setRemoteDescription(new g(a),b,c)}.bind(this))},j.prototype.getRemoteDescription=function(){return e.resolve(this.connection.remoteDescription)},j.prototype.getSignalingState=function(){return e.resolve(this.connection.signalingState)},j.prototype.updateIce=function(a){return this.connection.updateIce(a),e.resolve()},j.prototype.addIceCandidate=function(a){return new e(function(b,c){this.connection.addIceCandidate(new h(a),b,c)}.bind(this))},j.prototype.getIceGatheringState=function(){return e.resolve(this.connection.iceGatheringState)},j.prototype.getIceConnectionState=function(){return e.resolve(this.connection.iceConnectionState)},j.prototype.getConfiguration=function(){var a=this.connection.getConfiguration();return e.resolve(a)},j.prototype.getLocalStreams=function(){return e.reject({errcode:-1,message:"Not Implemented"})},j.prototype.getRemoteStreams=function(){return e.reject({errcode:-1,message:"Not Implemented"})},j.prototype.getStreamById=function(a){return e.reject({errcode:-1,message:"Not Implemented"})},j.prototype.addStream=function(a){return e.reject({errcode:-1,message:"Not Implemented"})},j.prototype.removeStream=function(a){return e.reject({errcode:-1,message:"Not Implemented"})},j.prototype.close=function(){if(!this.connection)return e.resolve();this.manageEvents(!1);try{return this.connection.close(),e.resolve()}catch(a){return e.reject({errcode:a.name,message:a.message})}},j.prototype.createDataChannel=function(a,b){var c=i.allocate(this.connection.createDataChannel(a,b));return e.resolve(c)},j.prototype.getStats=function(a){return new e(function(b,c){this.connection.getStats(a,b,c)}.bind(this))},j.prototype.ondatachannel=function(a){var b=i.allocate(a.channel);this.dispatchEvent("ondatachannel",{channel:b})},j.prototype.onnegotiationneeded=function(a){this.dispatchEvent("onnegotiationneeded",a.message)},j.prototype.onicecandidate=function(a){var b;b=a.candidate&&a.candidate.candidate?{candidate:{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex}}:{candidate:null},this.dispatchEvent("onicecandidate",b)},j.prototype.onsignalingstatechange=function(a){this.dispatchEvent("onsignalingstatechange",a.message)},j.prototype.onaddstream=function(a){this.dispatchEvent("onaddstream",a.stream)},j.prototype.onremovestream=function(a){this.dispatchEvent("onremovestream",a.stream)},j.prototype.oniceconnectionstatechange=function(a){this.dispatchEvent("oniceconnectionstatechange",a.message)},c.name="core.rtcpeerconnection",c.provider=j,c.style="providePromises",c.flags={provider:!0}},{"./core.rtcdatachannel":10,"es6-promise":2,"webrtc-adapter":4}],12:[function(a,b,c){var d=a("../../src/util"),e=function(a,b){d.handleEvents(this)};e.prototype.keys=function(a){var b,c=[];for(b=0;b<localStorage.length;b+=1)c.push(localStorage.key(b));a(c)},e.prototype.get=function(a,b){try{var c=localStorage.getItem(a);b(c)}catch(d){b(null)}},e.prototype.set=function(a,b,c){var d=localStorage.getItem(a);localStorage.setItem(a,b),c(d)},e.prototype.remove=function(a,b){var c=localStorage.getItem(a);localStorage.removeItem(a),b(c)},e.prototype.clear=function(a){localStorage.clear(),a()},c.provider=e,c.name="core.storage"},{"../../src/util":36}],13:[function(a,b,c){var d=a("../../src/proxy/eventInterface"),e=a("../../src/consumer"),f=a("../../src/util"),g=function(a,b){this.manager=a.module,this.debug=this.manager.debug};g.unboundChannels={},g.contextId=void 0,g.moduleInternal=void 0,g.prototype.createChannel=function(a){var b=new e(d,this.manager.debug),c=f.getId(),h=this.getChannel(b);this.manager.setup(b),this.isInModule()&&this.manager.emit(this.manager.delegate,{type:"Delegation",request:"handle",flow:"core",message:{type:"register",id:c}}),g.unboundChannels[c]={local:!0,proxy:b},b.once("start",this.getChannel.bind(this,b)),a({channel:h,identifier:c})},g.prototype.getChannel=function(a){var b=a.getProxyInterface(),c=b();return c.close=b.close,c.onClose=b.onClose,b.onClose(c,function(){a.doClose()}),c},g.prototype.onMessage=function(a,b){"register"===b.type?g.unboundChannels[b.id]={remote:!0,resolve:b.reply,source:a}:"clear"===b.type?delete g.unboundChannels[b.id]:"bind"===b.type?g.unboundChannels[b.id]&&this.bindChannel(b.id,function(){},a):"require"===b.type&&a.require(b.id,b.manifest)},g.prototype.bindChannel=function(a,b,c){var f=g.unboundChannels[a],h=!c;if(h&&(this.debug.debug("making local proxy for core binding"),c=new e(d,this.debug),this.manager.setup(c)),f&&f.local)this.debug.debug("Binding a channel to port on this hub:"+c),this.manager.createLink(c,a,f.proxy,"default"),delete g.unboundChannels[a],this.manager.delegate&&this.manager.toDelegate.core&&this.manager.emit(this.manager.delegate,{type:"Delegation",request:"handle",flow:"core",message:{type:"clear",id:a}});else{if(!f||!f.remote)return this.isInModule()?(this.debug.info("delegating channel bind for an unknown ID:"+a),this.manager.emit(this.manager.delegate,{type:"Delegation",request:"handle",flow:"core",message:{type:"bind",id:a}}),c.once("start",function(a,b){b(this.getChannel(a))}.bind(this,c,b)),this.manager.createLink(c,"default",this.manager.hub.getDestination(this.manager.delegate),a),void delete g.unboundChannels[a]):(this.debug.warn("Asked to bind unknown channel: "+a),this.debug.log(g.unboundChannels),void b());this.debug.debug("Binding a channel into a module."),this.manager.createLink(c,h?"default":a,f.source,a),f.resolve({type:"Bind Channel",request:"core",flow:"core",message:{type:"bind",id:a}}),delete g.unboundChannels[a]}c.getInterface?b(this.getChannel(c)):b()},g.prototype.isInModule=function(){return this.manager.delegate&&this.manager.toDelegate.core},g.prototype.require=function(a,b,c){if(this.isInModule()&&g.moduleInternal){var d=g.moduleInternal.registerId(b,c);this.manager.emit(this.manager.delegate,{type:"Delegation",request:"handle",flow:"core",message:{type:"require",manifest:a,id:d}})}else this.debug.error("The require function in external context makes no sense Instead create a new freedom() context."),c(void 0,{errcode:"InvalidContext",message:"Cannot call require() from this context."})},g.prototype.getId=function(a){a(g.contextId)},g.prototype.getLogger=function(a,b){b(this.manager.debug.getLogger(a))},g.prototype.setId=function(a,b){g.contextId=a,g.moduleInternal=b},c.provider=g,c.name="core",c.flags={module:!0}},{"../../src/consumer":21,"../../src/proxy/eventInterface":33,"../../src/util":36}],14:[function(a,b,c){var d=a("../../src/util"),e=a("es6-promise").Promise,f=function(a,b,c){this.provider=a,this.dispatchEvent=c,setTimeout(b.provider.onClose.bind(b.provider,this,this.close.bind(this,function(){})),0),this.module=b.module,d.handleEvents(this)};f.provider={listener:void 0,active:{},onOpen:function(a,b,c,d,f){var g,h,i=document.body;return this.listener||(this.listener=function(a){var b;for(b in this.active)this.active.hasOwnProperty(b)&&this.active[b].source===a.source&&this.active[b].postMessage(a.data)}.bind(this),window.addEventListener("message",this.listener,!0)),document.getElementById(b)&&(i=document.getElementById(b)),g=document.createElement("div"),g.style.width="100%",g.style.height="100%",g.style.display="relative",i.appendChild(g),new e(function(b,d){h=document.createElement("iframe"),h.setAttribute("sandbox","allow-scripts allow-forms"),h.style.width="100%",h.style.height="100%",h.style.border="0",h.style.background="transparent",h.src=c,h.addEventListener("load",b,!0),h.addEventListener("error",d,!0),g.appendChild(h),this.active[a]={postMessage:f,container:i,root:g,source:h.contentWindow}}.bind(this))},onMessage:function(a,b){this.active[a].source.postMessage(b,"*")},onClose:function(a){this.active[a].container.removeChild(this.active[a].root),delete this.active[a],0===Object.keys(this.active).length&&(window.removeEventListener("message",this.listener,!0),this.listener=void 0)}},f.prototype.show=function(a,b){if(this.id)return b(void 0,{errcode:"ALREADY_OPEN",message:"Cannot show multiple views through one instance."});this.id=d.getId();var c=this.module.manifest.views,f=[];return c&&c[a]?void(c[a].main&&c[a].files?(f=c[a].files.concat(c[a].main),e.all(f.map(function(a){return this.module.resource.get(this.module.manifestId,a)}.bind(this))).then(function(c){this.provider.onOpen(this.id,a,c[c.length-1],c,this.dispatchEvent.bind(this,"message")).then(function(a){a()}.bind({},b),b.bind({},void 0))}.bind(this),function(c){this.module.debug.error("Unable to open view "+a+": ",c),b(void 0,{errcode:"VIEW_MALFORMED",message:"Malformed View Declaration: "+c})})):b(void 0,{errcode:"NON_EXISTANT",message:"View not found: "+a})):b(void 0,{errcode:"NON_EXISTANT",message:"View not found: "+a})},f.prototype.isSecure=function(a){a(!1)},f.prototype.postMessage=function(a,b){return this.id?(this.provider.onMessage(this.id,a),void b()):b(void 0,{errcode:"NOT_OPEN",message:"Cannot post message to uninitialized view."})},f.prototype.close=function(a){return this.id?(this.provider.onClose(this.id),delete this.id,void a()):a(void 0,{errcode:"NOT_OPEN",message:"Cannot close uninitialized view."})},f.register=function(a){var b=a?new a:f.provider;c.provider=f.bind(this,b)},c.provider=f.bind(this,f.provider),c.name="core.view",c.register=f.register,c.flags={provider:!0,module:!0}},{"../../src/util":36,"es6-promise":2}],15:[function(a,b,c){var d=null,e=!1,f=function(a,b,c,f,g){var h,i=null;this.isNode=e,"undefined"!=typeof g?i=g:null!==d?i=d:"undefined"!=typeof WebSocket?i=WebSocket:console.error("Platform does not support WebSocket"),this.dispatchEvent=b;try{f?this.websocket=new i(c,f):this.websocket=new i(c),this.websocket.binaryType="arraybuffer"}catch(j){return h={},j instanceof SyntaxError?h.errcode="SYNTAX":h.errcode=j.name,h.message=j.message,void b("onError",h)}this.isNode?(this.websocket.on("message",this.onMessage.bind(this)),this.websocket.on("open",this.onOpen.bind(this)),this.websocket.on("close",this.onClose.bind(this,{code:0,reason:"UNKNOWN",wasClean:!0})),this.websocket.on("error",this.onError.bind(this))):(this.websocket.onopen=this.onOpen.bind(this),this.websocket.onclose=this.onClose.bind(this),this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onerror=this.onError.bind(this))};f.prototype.send=function(a,b){var c,d,e=a.text||a.binary||a.buffer;if(e)try{this.isNode&&e instanceof ArrayBuffer?this.websocket.send(new Uint8Array(e),{binary:!0},this.onError.bind(this)):this.websocket.send(e)}catch(f){c=f instanceof SyntaxError?"SYNTAX":"INVALID_STATE",d=f.message}else c="BAD_SEND",d="No text, binary, or buffer data found.";c?b(void 0,{errcode:c,message:d}):b()},f.prototype.getReadyState=function(a){a(this.websocket.readyState)},f.prototype.getBufferedAmount=function(a){a(this.websocket.bufferedAmount)},f.prototype.close=function(a,b,c){try{a&&b?this.websocket.close(a,b):this.websocket.close(),c()}catch(d){var e;e=d instanceof SyntaxError?"SYNTAX":"INVALID_ACCESS",c(void 0,{errcode:e,message:d.message})}},f.prototype.onOpen=function(a){this.dispatchEvent("onOpen")},f.prototype.onMessage=function(a,b){var c={};this.isNode&&b&&b.binary?c.buffer=new Uint8Array(a).buffer:this.isNode?c.text=a:"undefined"!=typeof ArrayBuffer&&a.data instanceof ArrayBuffer?c.buffer=a.data:"undefined"!=typeof Blob&&a.data instanceof Blob?c.binary=a.data:"string"==typeof a.data&&(c.text=a.data),this.dispatchEvent("onMessage",c)},f.prototype.onError=function(a){this.dispatchEvent("onError")},f.prototype.onClose=function(a){this.dispatchEvent("onClose",{code:a.code,reason:a.reason,wasClean:a.wasClean})},c.provider=f,c.name="core.websocket",c.setSocket=function(a,b){d=a,e=b}},{}],16:[function(a,b,c){var d=a("es6-promise").Promise,e=null,f=function(a,b){"use strict";"undefined"!=typeof window&&"undefined"!=typeof window.XMLHttpRequest&&null===e?e=window.XMLHttpRequest:"undefined"!=typeof XMLHttpRequest&&null===e?e=XMLHttpRequest:null===e&&console.error("Platform does not support XMLHttpRequest"),this._dispatchEvent=b,this._xhr=new e,setTimeout(a.provider.onClose.bind(a.provider,this,this.abort.bind(this)),0),this._events=["loadstart","progress","abort","error","load","timeout","loadend","readystatechange"],this._setupListeners()};f.prototype.open=function(a,b,c,e,f){"use strict";return"undefined"!=typeof c&&c!==!0?d.reject({errcode:"InvalidAccessError",message:"async should always be set to true"}):(this._xhr.open(a,b,!0,e,f),d.resolve())},f.prototype.send=function(a){"use strict";return a instanceof Object?a.hasOwnProperty("string")?this._xhr.send(a.string):a.hasOwnProperty("buffer")?this._xhr.send(a.buffer):a.hasOwnProperty("blob")?this._xhr.send(a.blob):this._xhr.send():this._xhr.send(),d.resolve()},f.prototype.abort=function(){"use strict";return this._xhr.abort(),d.resolve()},f.prototype.getResponseHeader=function(a){"use strict";return d.resolve(this._xhr.getResponseHeader(a))},f.prototype.getAllResponseHeaders=function(){"use strict";return d.resolve(this._xhr.getAllResponseHeaders())},f.prototype.setRequestHeader=function(a,b){"use strict";return this._xhr.setRequestHeader(a,b),d.resolve()},f.prototype.overrideMimeType=function(a){"use strict";return this._xhr.overrideMimeType(a),d.resolve()},f.prototype.getReadyState=function(){"use strict";return d.resolve(this._xhr.readyState)},f.prototype.getResponse=function(){"use strict";return null===this._xhr.response?d.resolve(null):"text"===this._xhr.responseType||""===this._xhr.responseType?d.resolve({string:this._xhr.response}):"arraybuffer"===this._xhr.responseType?d.resolve({buffer:this._xhr.response}):"json"===this._xhr.responseType?d.resolve({object:this._xhr.response}):d.reject("core.xhr cannot determine type of response")},f.prototype.getResponseText=function(){"use strict";return d.resolve(this._xhr.responseText)},f.prototype.getResponseURL=function(){"use strict";return d.resolve(this._xhr.responseURL)},f.prototype.getResponseType=function(){"use strict";return d.resolve(this._xhr.responseType)},f.prototype.setResponseType=function(a){"use strict";return this._xhr.responseType=a,d.resolve()},f.prototype.getStatus=function(){"use strict";return d.resolve(this._xhr.status)},f.prototype.getStatusText=function(){"use strict";return d.resolve(this._xhr.statusText)},f.prototype.getTimeout=function(){"use strict";return d.resolve(this._xhr.timeout)},f.prototype.setTimeout=function(a){"use strict";return this._xhr.timeout=a,d.resolve()},f.prototype.getWithCredentials=function(){"use strict";return d.resolve(this._xhr.withCredentials)},f.prototype.setWithCredentials=function(a){"use strict";return this._xhr.withCredentials=a,d.resolve()},f.prototype._setupListeners=function(){"use strict";this._events.forEach(function(a){this._xhr.addEventListener(a,function(a,b){this._dispatchEvent("on"+a,b)}.bind(this,a),!1)}.bind(this)),this._events.forEach(function(a){this._xhr.upload.addEventListener(a,function(a,b){this._dispatchEvent("onupload"+a,b)}.bind(this,a),!1)}.bind(this))},c.name="core.xhr",c.provider=f,c.style="providePromises",c.flags={provider:!0},c.setImpl=function(a){"use strict";e=a}},{"es6-promise":2}],17:[function(a,b,c){var d=(a("es6-promise").Promise,"freedom.oauth.redirect.handler"),e=!1,f=5e3;"undefined"!=typeof window&&window&&window.location&&window.addEventListener&&(window.addEventListener("load",function(){"use strict";e=!0},!0),window.localStorage&&window.location.href.indexOf(d)>0&&(window.localStorage.setItem(d,new Date),window.close()));var g=function(){"use strict";this.listeners={}};g.prototype.initiateOAuth=function(a,b){"use strict";if("undefined"!=typeof window&&window&&e){var c=window.location.protocol+"//"+window.location.host+window.location.pathname;if(a.indexOf(c)>-1)return b({redirect:c,state:d+Math.random()}),!0}return!1},g.prototype.launchAuthFlow=function(a,b,c,d){"use strict";var e=this.storageListener.bind(this,d,b);this.listeners[b.state]=e,window.addEventListener("storage",e,!1),window.open(a),c===!1&&setTimeout(function(){this.listeners[b.state]&&(window.removeEventListener("storage",this.listeners[b.state],!1),delete this.listeners[b.state],d(void 0,"Error launching auth flow"))}.bind(this),f)},g.prototype.storageListener=function(a,b,c){"use strict";c.url.indexOf(b.state)>-1&&(window.removeEventListener("storage",this.listeners[b.state],!1),delete this.listeners[b.state],a(c.url))},b.exports=g},{"es6-promise":2}],18:[function(a,b,c){(function(c){function d(){"use strict";this.listeners={}}var e=(a("es6-promise").Promise,"freedom.oauth.redirect.handler"),f=5e3;d.prototype.initiateOAuth=function(a,b){"use strict";if("undefined"!=typeof c&&c&&c.document)for(var d=0;d<a.length;d++)if((0===a[d].indexOf("http://")||0===a[d].indexOf("https://"))&&a[d].indexOf("oauth-relay.html")>0)return b({redirect:a[d],state:e+Math.random()}),!0;return!1},d.prototype.launchAuthFlow=function(a,b,d,e){"use strict";var g=c.document.createElement("iframe");g.src=b.redirect,g.style.display="none",c.document.body.appendChild(g),g.addEventListener("load",function(){this.listeners[b.state]=e,window.open(a),g.contentWindow.postMessage(b.state,"*")}.bind(this));var h=!1;window.addEventListener("message",function(a,b){if(b.data&&b.data.key&&b.data.url&&this.listeners[b.data.key]){h=!0,this.listeners[b.data.key](b.data.url),delete this.listeners[b.data.key];try{document.body.removeChild(a)}catch(c){console.warn(c)}}}.bind(this,g),!1),d===!1&&setTimeout(function(){if(h===!1){e(void 0,"Error launching auth flow"),delete this.listeners[b.state];try{document.body.removeChild(g)}catch(a){console.warn(a)}}}.bind(this),f)},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"es6-promise":2}],19:[function(a,b,c){var d=a("es6-promise").Promise,e=function(a){this.debug=a,this.apis={},this.providers={},this.waiters={}};e.prototype.get=function(a){return this.apis[a]?{name:a,definition:this.apis[a]}:!1},e.prototype.set=function(a,b){this.apis[a]=b},e.prototype.register=function(a,b,c,d){var e,f;if(this.providers[a]={constructor:b,style:c||"provideAsynchronous",flags:d||{}},this.waiters[a]){for(e=0;e<this.waiters[a].length;e+=1)f={},d.module&&(f.module=this.waiters[a][e].from),d.config&&(f.config=this.waiters[a][e].from.config),this.waiters[a][e].resolve({args:f,inst:b.bind({},f)});delete this.waiters[a]}},e.prototype.getCore=function(a,b){return new d(function(c,d){if(this.apis[a])if(this.providers[a]){var e={};this.providers[a].flags.module&&(e.module=b),this.providers[a].flags.config&&(e.config=b.config),c({args:e,inst:this.providers[a].constructor.bind({},e)})}else this.waiters[a]||(this.waiters[a]=[]),this.waiters[a].push({resolve:c,reject:d,from:b});else this.debug.warn("Api.getCore asked for unknown core: "+a),d(null)}.bind(this))},e.prototype.provideCore=function(a,b,c){return this.getCore(a,c).then(function(c){var d=this.providers[a].flags,e=b.getProxyInterface();d.provider&&(c.args.provider=e),e()[this.providers[a].style](c.inst)}.bind(this),function(a){this.debug.error("Could not provide core: ",a)}.bind(this))},e.prototype.cleanup=function(){var a,b=function(a){a.reject()};for(a in this.waiters)this.waiters.hasOwnProperty(a)&&this.waiters[a].forEach(b);delete this.waiters},b.exports=e},{"es6-promise":2}],20:[function(a,b,c){var d=function(){"use strict";this.interfaces=a("../dist/bundle.compiled")};c.register=function(a,b){"use strict";var c=new d;c.interfaces.forEach(function(a){a&&a.name&&a.api&&b.set(a.name,a.api)}),a.forEach(function(a){a.name&&b.register(a.name,a.provider,a.style,a.flags)})}},{"../dist/bundle.compiled":1}],21:[function(a,b,c){var d=a("./util"),e=function(a,b){this.id=e.nextId(),this.interfaceCls=a,this.debug=b,d.handleEvents(this),this.ifaces={},this.closeHandlers={},this.errorHandlers={},this.emits={}};e.prototype.onMessage=function(a,b){if("control"===a&&b.reverse)this.emitChannel=b.channel,this.emit(this.emitChannel,{type:"channel announcement",channel:b.reverse}),this.emit("start");else if("control"===a&&"setup"===b.type)this.controlChannel=b.channel;else if("control"===a&&"close"===b.type)delete this.controlChannel,this.doClose();else{if(!this.emitChannel&&b.channel)return this.emitChannel=b.channel,void this.emit("start");if("close"===b.type&&b.to)return void this.teardown(b.to);if("error"===b.type)return void this.error(b.to,b.message);if(b.to)this.emits[b.to]?this.emits[b.to]("message",b.message):this.debug.warn("Could not deliver message, no such interface: "+b.to);else{b.message;d.eachProp(this.emits,function(a){a("message",b.message)})}}},e.prototype.getInterface=function(){var a=this.getInterfaceConstructor(),b=Array.prototype.slice.call(arguments,0);return b.length&&(a=a.bind.apply(a,[a].concat(b))),new a},e.prototype.getListener=function(a){return function(b,c){if("function"==typeof b&&void 0===c)return void this.once(a,b);var e=a+"Handlers";d.eachProp(this.ifaces,function(a,d){return a===b?(this[e][d]?this[e][d].push(c):this[e][d]=[c],!0):void 0}.bind(this))}.bind(this)},e.prototype.getProxyInterface=function(){var a=function(a){var b=Array.prototype.slice.call(arguments,1);return b.length>0?a.getInterface.apply(a,b):a.getInterface()}.bind({},this);return a.close=function(a){a?d.eachProp(this.ifaces,function(b,c){return b===a?(this.teardown(c),this.emit(this.emitChannel,{type:"close",to:c}),!0):void 0}.bind(this)):this.doClose()}.bind(this),a.onClose=this.getListener("close"),a.onError=this.getListener("error"),a},e.prototype.getInterfaceConstructor=function(){var a=e.nextId();return this.interfaceCls.bind({},function(a,b,c){this.ifaces[a]=b,this.emits[a]=c}.bind(this,a),this.doEmit.bind(this,a),this.debug)},e.prototype.doEmit=function(a,b,c){c&&(a=!1),this.emitChannel?this.emit(this.emitChannel,{to:a,type:"message",message:b}):this.once("start",this.doEmit.bind(this,a,b))},e.prototype.teardown=function(a){this.emits[a]&&this.emits[a]("close"),delete this.emits[a],this.closeHandlers[a]&&d.eachProp(this.closeHandlers[a],function(a){a()}),delete this.ifaces[a],delete this.closeHandlers[a],delete this.errorHandlers[a]},e.prototype.error=function(a,b){a&&this.errorHandlers[a]?d.eachProp(this.errorHandlers[a],function(a){a(b)}):a||this.emit("error",b)},e.prototype.doClose=function(){this.controlChannel&&this.emit(this.controlChannel,{type:"Channel Closing",request:"close"}),d.eachProp(this.emits,function(a,b){this.teardown(b)}.bind(this)),this.emit("close"),this.off(),this.emitChannel=null},e.prototype.toString=function(){return this.emitChannel?"[Consumer "+this.emitChannel+"]":"[unbound Consumer]"},e.nextId=function(){return e.id||(e.id=1),e.id+=1},e.messageToPortable=function(a,b,c){var d=[],f=e.conform(a,b,d,!0,c);return{text:f,binary:d}},e.portableToMessage=function(a,b,c){return e.conform(a,b.text,b.binary,!1,c)},e.conform=function(a,b,c,f,g){if("function"==typeof b&&"proxy"!==a)return void g.error("Message discarded as functions can't cross modules!");if("undefined"!=typeof b){if(null===b)return null;if(void 0===a)return void g.error("Message discarded for not matching declared type!",b);switch(a){case"string":return String("")+b;case"number":return Number(1)*b;case"boolean":return Boolean(b===!0);case"object":return"undefined"==typeof b?void 0:JSON.parse(JSON.stringify(b));case"blob":return f?b instanceof Blob?(c.push(b),c.length-1):(g.error("conform expecting Blob, but saw "+typeof b),c.push(new Blob([])),c.length-1):c[b];case"buffer":return f?(c.push(e.makeArrayBuffer(b,g)),c.length-1):e.makeArrayBuffer(c[b],g);case"proxy":return b}var h,i;if(Array.isArray(a)&&void 0!==b){if(h=[],i=0,2===a.length&&"array"===a[0])for(i=0;i<b.length;i+=1)h.push(e.conform(a[1],b[i],c,f,g));else for(i=0;i<a.length;i+=1)void 0!==b[i]?h.push(e.conform(a[i],b[i],c,f,g)):h.push(void 0);return h}return"object"==typeof a&&void 0!==b?(h={},d.eachProp(a,function(a,d){void 0!==b[d]&&(h[d]=e.conform(a,b[d],c,f,g))}),h):void g.error("Unknown template provided: "+a)}},e.makeArrayBuffer=function(a,b){return a?a instanceof ArrayBuffer?a:"ArrayBuffer"===a.constructor.name&&"undefined"==typeof a.prototype?new DataView(a).buffer:(b.error("expecting ArrayBuffer, but saw "+typeof a+": "+JSON.stringify(a)),
new ArrayBuffer(0)):new ArrayBuffer(0)},e.recursiveFreezeObject=function(a){var b,c={};if("object"!=typeof a)return a;for(b in a)a.hasOwnProperty(b)&&Object.defineProperty(c,b,{value:e.recursiveFreezeObject(a[b]),writable:!1,enumerable:!0});return c},b.exports=e},{"./util":36}],22:[function(a,b,c){var d=a("./util"),e=function(a){this.id="debug",this.emitChannel=!1,this.config=!1,d.handleEvents(this)};e.LEVELS=["debug","info","log","warn","error"],e.prototype.toString=function(){return"[Console]"},e.prototype.setLogger=function(a){this.logger&&this.info("Replacing Logger."),this.logger=a,this.emit("logger")},e.prototype.onMessage=function(a,b){"control"===a&&b.channel&&!this.emitChannel&&(this.emitChannel=b.channel,this.config=b.config,this.config.global.console||("undefined"!=typeof console?this.config.global.console=console:this.config.global.console=this.getLogger("Console")),this.emit("ready"))},e.prototype.format=function(a,b,c){var d,e,f=[];if("string"==typeof c&&b)try{e=JSON.parse(c),e instanceof Array&&(c=e)}catch(g){}if("string"==typeof c)f.push(c);else for(d=0;d<c.length;d+=1)f.push(c[d]);return this.emitChannel?void this.emit(this.emitChannel,{severity:a,source:b,quiet:!0,request:"debug",msg:JSON.stringify(f)}):void this.on("ready",this.format.bind(this,a,b,f))},e.prototype.print=function(a){if(!this.logger)return void this.once("logger",this.print.bind(this,a));var b,c=[],d=0;if(b=JSON.parse(a.msg),"string"==typeof b)c.push(b);else for(;void 0!==b[d];)c.push(b[d]),d+=1;this.logger[a.severity].call(this.logger,a.source,c,function(){})},e.prototype.log=function(){this.format("log",void 0,arguments)},e.prototype.info=function(){this.format("info",void 0,arguments)},e.prototype.debug=function(){this.format("debug",void 0,arguments)},e.prototype.warn=function(){this.format("warn",void 0,arguments)},e.prototype.error=function(){this.format("error",void 0,arguments)},e.prototype.getLogger=function(a){var b=function(a,b){var c=Array.prototype.splice.call(arguments,2);this.format(a,b,c)},c={freedom:!0};return e.LEVELS.forEach(function(d){c[d]=b.bind(this,d,a)}.bind(this)),c},e.prototype.getLoggingShim=function(a){return function(b){var c=a(b),d=[],f=e.LEVELS,g=null,h={};return c.then(function(a){g=a,d.forEach(function(a){g[a[0]].apply(g,a[1])})}),f.forEach(function(a){h[a]=function(){var a=Array.prototype.splice.call(arguments,0);g?g[this].apply(g,a):d.push([this,a])}.bind(a)}),h}},b.exports=e},{"./util":36}],23:[function(a,b,c){(function(c){var d,e=a("es6-promise").Promise,f=a("./api"),g=a("./debug"),h=a("./hub"),i=a("./manager"),j=a("./policy"),k=a("./proxybinder"),l=a("./resource"),m=a("./util"),n=a("./bundle"),o=function(){"use strict";"undefined"!=typeof c&&void 0===c.prototype?d=c:setTimeout(function(){d=this},0)};o();var p=function(a,b,c){"use strict";var o,p,q,r=new g,s=new h(r),t=new l(r),u=new f(r),v=new i(s,t,u),w=new k(v),x={debug:"log",manifest:b,moduleContext:a&&"undefined"!=typeof a.isModule?a.isModule:m.isModuleContext()},y=function(){u.cleanup(),v.destroy()};return c&&m.mixin(x,c,!0),x.global=d,a&&m.mixin(x,a,!0),a.providers.forEach(function(a){var b;0===a.name.indexOf("core.")&&"function"==typeof a.register&&(b=a.name.substr(5),c&&c[b]?a.register(c[b]):x[b]?a.register(x[b]):a.register(void 0))}),n.register(a.providers,u),t.register(a.resolvers||[]),new e(function(a,b){if(x.moduleContext)q=x.portType,p=new q("Outbound",t),v.setup(p),v.once("delegate",v.setup.bind(v,r));else{v.setup(r),o=new j(v,t,x);var c,d;c=function(a){u.getCore("core.console",{config:x}).then(function(b){var c=new b.inst;r.setLogger(c),a&&r.error(a)})},d=function(a){return t.get(x.location,a).then(function(a){return o.get([],a)}).then(function(a){return v.setup(a),w.bindDefault(a,u,a.manifest)})},x.logger?d(x.logger).then(function(a){"console"!==a.external.api?c("Unwilling to use logger with unknown API:",a.external.api):r.setLogger(a.external())},c):c(),d(x.manifest).then(function(a){return a.port.once("close",y),a.external},function(a){throw r.error("Failed to retrieve manifest: "+a),a}).then(a,b)}s.emit("config",x)})};b.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./api":19,"./bundle":20,"./debug":22,"./hub":24,"./manager":27,"./policy":30,"./proxybinder":34,"./resource":35,"./util":36,"es6-promise":2}],24:[function(a,b,c){var d=a("./util"),e=function(a){this.debug=a,this.config={},this.apps={},this.routes={},d.handleEvents(this),this.on("config",function(a){d.mixin(this.config,a)}.bind(this))};e.prototype.onMessage=function(a,b){var c,d=this.routes[a];return d&&d.app?this.apps[d.app]?(!b.quiet&&!d.quiet&&this.config&&this.config.trace&&(c=b.type,"message"===b.type&&b.message&&"method"===b.message.action?c="method."+b.message.type:"method"===b.type&&b.message&&"method"===b.message.type?c="return."+b.message.name:"message"===b.type&&b.message&&"event"===b.message.type&&(c="event."+b.message.name),this.debug.debug(this.apps[d.source].toString()+" -"+c+"-> "+this.apps[d.app].toString()+"."+d.flow)),void this.apps[d.app].onMessage(d.flow,b)):void this.debug.warn("Message dropped to destination "+d.app):void this.debug.warn("Message dropped from unregistered source "+a)},e.prototype.getDestination=function(a){var b=this.routes[a];return b?this.apps[b.app]:null},e.prototype.getSource=function(a){return a?this.apps[a.id]?this.apps[a.id]:(this.debug.warn("No registered source '"+a.id+"'"),!1):!1},e.prototype.register=function(a,b){return!this.apps[a.id]||b?(this.apps[a.id]=a,!0):!1},e.prototype.deregister=function(a){return this.apps[a.id]?(delete this.apps[a.id],!0):!1},e.prototype.install=function(a,b,c,d){if(a=this.getSource(a)){if(!b)return void this.debug.warn("Unwilling to generate blackhole flow from "+a.id);var e=this.generateRoute();return this.routes[e]={app:b,flow:c,source:a.id,quiet:d},"function"==typeof a.on&&a.on(e,this.onMessage.bind(this,e)),e}},e.prototype.uninstall=function(a,b){if(a=this.getSource(a)){var c=this.routes[b];return c?c.source!==a.id?(this.debug.warn("Flow "+b+" does not belong to port "+a.id),!1):(delete this.routes[b],"function"==typeof a.off&&a.off(c),!0):!1}},e.prototype.teardown=function(){d.eachProp(this.apps,function(a){"function"==typeof a.off&&a.off()}),this.apps={},this.routes={}},e.prototype.generateRoute=function(){return d.getId()},b.exports=e},{"./util":36}],25:[function(a,b,c){var d=a("./util"),e=function(a,b){this.id="Link"+Math.random(),this.name=a,this.resource=b,this.config={},this.src=null,d.handleEvents(this),d.mixin(this,e.prototype)};e.prototype.onMessage=function(a,b){"control"!==a||this.controlChannel?this.deliverMessage(a,b):!this.controlChannel&&b.channel&&(this.controlChannel=b.channel,d.mixin(this.config,b.config),this.start())},e.prototype.addErrorHandler=function(a){this.onError=a},e.prototype.onError=function(a){},e.prototype.emitMessage=function(a,b){"control"===a&&this.controlChannel&&(a=this.controlChannel),this.emit(a,b)},b.exports=e},{"./util":36}],26:[function(a,b,c){var d=a("../link"),e=function(a,b){d.call(this,a,b),a&&(this.id=a)};e.prototype.start=function(){this.config.moduleContext?this.setupListener():this.setupWorker()},e.prototype.stop=function(){},e.prototype.toString=function(){return"[Worker "+this.id+"]"},e.prototype.setupListener=function(){var a=function(a){this.emitMessage(a.data.flow,a.data.message)}.bind(this);this.obj=this.config.global,this.obj.addEventListener("message",a,!0),this.stop=function(){this.obj.removeEventListener("message",a,!0),delete this.obj},this.emit("started"),this.obj.postMessage("Ready For Messages")},e.prototype.setupWorker=function(){var a;a=new Worker(this.config.source+"#"+this.id),a.addEventListener("error",function(a){this.onError(a)}.bind(this),!0),a.addEventListener("message",function(a,b){return this.obj?void this.emitMessage(b.data.flow,b.data.message):(this.obj=a,void this.emit("started"))}.bind(this,a),!0),this.stop=function(){a.terminate(),this.obj&&delete this.obj}},e.prototype.deliverMessage=function(a,b){"control"===a&&"close"===b.type&&"control"===b.channel?this.stop():this.obj?this.obj.postMessage({flow:a,message:b}):this.once("started",this.onMessage.bind(this,a,b))},b.exports=e},{"../link":25}],27:[function(a,b,c){var d=a("./util"),e=a("./moduleinternal"),f=function(a,b,c){this.id="control",this.config={},this.controlFlows={},this.dataFlows={},this.dataFlows[this.id]=[],this.reverseFlowMap={},this.debug=a.debug,this.hub=a,this.resource=b,this.api=c,this.delegate=null,this.toDelegate={},this.hub.on("config",function(a){d.mixin(this.config,a),this.emit("config")}.bind(this)),d.handleEvents(this),this.hub.register(this)};f.prototype.toString=function(){return"[Local Controller]"},f.prototype.onMessage=function(a,b){var c,d=this.controlFlows[a];if(!d)return void this.debug.warn("Unknown message source: "+a);if(c=this.hub.getDestination(d),this.delegate&&d!==this.delegate&&this.toDelegate[a])return void this.emit(this.delegate,{type:"Delegation",request:"handle",quiet:!0,flow:a,message:b});if("debug"===b.request)return void this.debug.print(b);if("link"===b.request)this.createLink(c,b.name,b.to,b.overrideDest);else if("environment"===b.request)this.createLink(c,b.name,new e(this));else if("delegate"===b.request)null===this.delegate&&(this.delegate=d),this.toDelegate[b.flow]=!0,this.emit("delegate");else if("resource"===b.request)this.resource.addResolver(b.args[0]),this.resource.addRetriever(b.service,b.args[1]);else if("core"===b.request){if(this.core&&d===this.delegate)return void(new this.core).onMessage(c,b.message);this.getCore(function(a,b){this.hub.onMessage(a,{type:"core",core:b})}.bind(this,d))}else if("close"===b.request)this.destroy(c);else{if("unlink"!==b.request)return this.debug.warn("Unknown control request: "+b.request),void this.debug.log(JSON.stringify(b));this.removeLink(c,b.to)}},f.prototype.getPort=function(a){return this.hub.getDestination(this.controlFlows[a])},f.prototype.setup=function(a){if(!a.id)return this.debug.warn("Refusing to setup unidentified port "),!1;if(this.controlFlows[a.id])return this.debug.warn("Refusing to re-initialize port "+a.id),!1;if(!this.config.global)return void this.once("config",this.setup.bind(this,a));this.hub.register(a);var b=this.hub.install(this,a.id,"control"),c=this.hub.install(a,this.id,a.id);return this.controlFlows[a.id]=b,this.dataFlows[a.id]=[c],this.reverseFlowMap[b]=c,this.reverseFlowMap[c]=b,a.lineage&&this.emit("moduleAdd",{id:a.id,lineage:a.lineage}),this.hub.onMessage(b,{type:"setup",channel:c,config:this.config}),!0},f.prototype.destroy=function(a){if(!a)return d.eachProp(this.controlFlows,function(a){this.hub.onMessage(a,{type:"close"})}.bind(this)),void this.hub.teardown();if(!a.id)return this.debug.warn("Unable to tear down unidentified port"),!1;a.lineage&&this.emit("moduleRemove",{id:a.id,lineage:a.lineage}),delete this.controlFlows[a.id];var b;for(b=this.dataFlows[a.id].length-1;b>=0;b-=1)this.removeLink(a,this.dataFlows[a.id][b]);delete this.dataFlows[a.id],this.hub.deregister(a)},f.prototype.createLink=function(a,b,c,d,e){if(!this.config.global)return void this.once("config",this.createLink.bind(this,a,b,c,d));if(!this.controlFlows[a.id])return void this.debug.warn("Unwilling to link from non-registered source.");if(!this.controlFlows[c.id]&&this.setup(c)===!1)return void this.debug.warn("Could not find or setup destination.");var f,g=c.quiet||!1,h=d||"default",i=this.hub.install(a,c.id,h,g);c=this.hub.getDestination(i),f=this.hub.install(c,a.id,b,g),this.reverseFlowMap[i]=f,this.dataFlows[a.id].push(i),this.reverseFlowMap[f]=i,this.dataFlows[c.id].push(f),e?this.hub.onMessage(this.controlFlows[c.id],{type:"createLink",name:h,channel:f,reverse:i}):this.hub.onMessage(this.controlFlows[a.id],{name:b,type:"createLink",channel:i,reverse:f})},f.prototype.removeLink=function(a,b){var c,d=this.hub.getDestination(b),e=this.reverseFlowMap[b];return d&&e?this.hub.getDestination(e).id!==a.id?void this.debug.warn("Source port does not own flow "+b):(c=this.controlFlows[a.id],c&&this.hub.onMessage(c,{type:"close",channel:b}),c=this.controlFlows[d.id],c&&this.hub.onMessage(c,{type:"close",channel:e}),this.hub.uninstall(a,b),this.hub.uninstall(d,e),delete this.reverseFlowMap[b],delete this.reverseFlowMap[e],this.forgetFlow(d.id,e),void this.forgetFlow(a.id,b)):void this.debug.warn("Could not find metadata to remove flow: "+b)},f.prototype.forgetFlow=function(a,b){var c;if(this.dataFlows[a])for(c=0;c<this.dataFlows[a].length;c+=1)if(this.dataFlows[a][c]===b){this.dataFlows[a].splice(c,1);break}},f.prototype.getCore=function(a){this.core?a(this.core):this.api.getCore("core",this).then(function(b){this.core=b.inst,a(this.core)}.bind(this),function(){a(void 0)})},b.exports=f},{"./moduleinternal":29,"./util":36}],28:[function(a,b,c){var d=a("./util"),e=a("./provider"),f=function(a,b,c,e){this.api=e.api,this.policy=e,this.resource=e.resource,this.debug=e.debug,this.config={},this.id=a+Math.random(),this.manifestId=a,this.manifest=b,this.lineage=[this.manifestId].concat(c),this.quiet=this.manifest.quiet||!1,this.externalPortMap={},this.internalPortMap={},this.dependantChannels=[],this.started=!1,d.handleEvents(this)};f.prototype.onMessage=function(a,b){if("control"===a){if("setup"===b.type)return this.controlChannel=b.channel,d.mixin(this.config,b.config),this.emit(this.controlChannel,{type:"Core Provider",request:"core"}),void this.start();if("createLink"===b.type&&b.channel){this.debug.debug(this+"got create link for "+b.name),this.externalPortMap[b.name]=b.channel,void 0===this.internalPortMap[b.name]&&(this.internalPortMap[b.name]=!1);var c={type:"default channel announcement",channel:b.reverse};return this.manifest.dependencies&&this.manifest.dependencies[b.name]&&(c.api=this.manifest.dependencies[b.name].api),void this.emit(b.channel,c)}if(b.core)return this.core=new b.core,void this.emit("core",b.core);"close"===b.type?(b.channel&&"control"!==b.channel||this.stop(),this.deregisterFlow(b.channel,!1)):this.port.onMessage(a,b)}else{if((this.externalPortMap[a]===!1||!this.externalPortMap[a])&&b.channel)return this.debug.debug(this+"handling channel announcement for "+a),this.externalPortMap[a]=b.channel,void(void 0===this.internalPortMap[a]&&(this.internalPortMap[a]=!1,this.manifest.provides&&this.modInternal?this.port.onMessage(this.modInternal,{type:"Connection",channel:a,api:b.api}):this.manifest.provides?this.once("modInternal",function(a,b){this.port.onMessage(this.modInternal,{type:"Connection",channel:a,api:b})}.bind(this,a,b.api)):!this.externalPortMap["default"]&&b.channel&&(this.externalPortMap["default"]=b.channel,this.once("internalChannelReady",function(a){this.internalPortMap[a]=this.internalPortMap["default"]}.bind(this,a)))));if(this.started)if(this.internalPortMap[a]===!1)console.warn("waiting on internal channel for msg"),this.once("internalChannelReady",this.onMessage.bind(this,a,b));else{if(!this.internalPortMap[a])return void this.debug.error("Unexpected message from "+a);this.port.onMessage(this.internalPortMap[a],b)}else this.once("start",this.onMessage.bind(this,a,b))}},f.prototype.deregisterFlow=function(a,b){var c,d=b?this.internalPortMap:this.externalPortMap;for(c in d)if(d[c]===a){b?this.emit(this.controlChannel,{type:"Channel Teardown",request:"unlink",to:this.externalPortMap[c]}):this.port&&this.port.onMessage("control",{type:"close",channel:this.internalPortMap[c]}),delete this.externalPortMap[c],delete this.internalPortMap[c];for(c in this.externalPortMap)if(this.externalPortMap.hasOwnProperty(c)&&this.dependantChannels.indexOf(c)<0)return!0;return this.stop(),!0}return!1},f.prototype.start=function(){var a;return this.started||this.port?!1:void(this.controlChannel&&(this.loadLinks(),a=this.config.portType,this.port=new a(this.manifest.name,this.resource),this.port.on(this.emitMessage.bind(this)),this.port.addErrorHandler(function(a){this.debug.warn("Module Failed",a),this.emit(this.controlChannel,{request:"close"})}.bind(this)),this.port.onMessage("control",{channel:"control",config:this.config}),this.port.onMessage("control",{type:"Redirect",request:"delegate",flow:"debug"}),this.port.onMessage("control",{type:"Redirect",request:"delegate",flow:"core"}),this.port.onMessage("control",{type:"Environment Configuration",request:"environment",name:"ModInternal"})))},f.prototype.stop=function(){this.started&&(this.emit("close"),this.port&&(this.port.off(),this.port.onMessage("control",{type:"close",channel:"control"}),this.port.stop(),delete this.port),delete this.policy,this.started=!1)},f.prototype.toString=function(){return"[Module "+this.manifest.name+"]"},f.prototype.emitMessage=function(a,b){if(this.internalPortMap[a]===!1&&b.channel)return this.internalPortMap[a]=b.channel,void this.emit("internalChannelReady");if("control"===a)if("debug"===b.flow&&b.message)this.debug.format(b.message.severity,b.message.source||this.toString(),b.message.msg);else if("core"===b.flow&&b.message){if(!this.core)return void this.once("core",this.emitMessage.bind(this,a,b));("register"===b.message.type||"require"===b.message.type)&&(b.message.reply=this.port.onMessage.bind(this.port,"control"),this.externalPortMap[b.message.id]=!1),this.core.onMessage(this,b.message)}else"ModInternal"!==b.name||this.modInternal?"createLink"===b.type?(this.internalPortMap[b.name]=b.channel,this.port.onMessage(b.channel,{type:"channel announcement",channel:b.reverse}),this.emit("internalChannelReady")):"close"===b.type&&this.deregisterFlow(b.channel,!0):(this.modInternal=b.channel,this.port.onMessage(this.modInternal,{type:"Initialization",id:this.manifestId,appId:this.id,manifest:this.manifest,lineage:this.lineage,channel:b.reverse}),this.emit("modInternal"));else"ModInternal"!==a||"ready"!==b.type||this.started?"ModInternal"===a&&"resolve"===b.type?this.resource.get(this.manifestId,b.data).then(function(a,b){this.port.onMessage(this.modInternal,{type:"resolve.response",id:a,data:b})}.bind(this,b.id),function(){this.debug.warn("Error Resolving URL for Module.")}.bind(this)):this.emit(this.externalPortMap[a],b):(this.started=!0,this.emit("start"));return!1},f.prototype.require=function(a,b){this.dependantChannels.push(a),this.addDependency(b,a)["catch"](function(b){this.port.onMessage(this.modInternal,{type:"require.failure",id:a,error:b.message})}.bind(this))},f.prototype.addDependency=function(a,b){return this.resource.get(this.manifestId,a).then(function(a){return this.policy.get(this.lineage,a)}.bind(this)).then(function(a){return this.updateEnv(b,a.manifest),this.emit(this.controlChannel,{type:"Link to "+b,request:"link",name:b,overrideDest:b+"."+this.id,to:a}),a}.bind(this))["catch"](function(a){throw this.debug.warn(this.toString()+" failed to load dep: ",b,a),a}.bind(this))},f.prototype.loadLinks=function(){var a,b,c,f=["default"];if(this.manifest.permissions)for(a=0;a<this.manifest.permissions.length;a+=1)b=this.manifest.permissions[a],f.indexOf(b)<0&&0===b.indexOf("core.")&&(f.push(b),this.dependantChannels.push(b),c=new e(this.api.get(b).definition,this.debug),this.api.provideCore(b,c,this),this.emit(this.controlChannel,{type:"Core Link to "+b,request:"link",name:b,to:c}));for(this.manifest.dependencies&&d.eachProp(this.manifest.dependencies,function(a,b){f.indexOf(b)<0&&(f.push(b),this.dependantChannels.push(b)),this.addDependency(a.url,b)}.bind(this)),a=0;a<f.length;a+=1)this.externalPortMap[f[a]]=this.externalPortMap[f[a]]||!1,this.internalPortMap[f[a]]=!1},f.prototype.updateEnv=function(a,b){if(b){if(!this.modInternal)return void this.once("modInternal",this.updateEnv.bind(this,a,b));var c;c={name:b.name,icon:b.icon,description:b.description,api:b.api},this.port.onMessage(this.modInternal,{type:"manifest",name:a,manifest:c})}},b.exports=f},{"./provider":31,"./util":36}],29:[function(a,b,c){var d=a("es6-promise").Promise,e=(a("./proxy/apiInterface"),a("./provider")),f=a("./proxybinder"),g=a("./util"),h=function(a){this.config={},this.manager=a,this.debug=a.debug,this.binder=new f(this.manager),this.api=this.manager.api,this.manifests={},this.providers={},this.id="ModuleInternal",this.pendingPorts=0,this.requests={},this.unboundPorts={},g.handleEvents(this)};h.prototype.onMessage=function(a,b){if("control"===a)!this.controlChannel&&b.channel&&(this.controlChannel=b.channel,g.mixin(this.config,b.config));else if("default"!==a||this.appId)"default"===a&&"resolve.response"===b.type&&this.requests[b.id]?(this.requests[b.id](b.data),delete this.requests[b.id]):"default"===a&&"require.failure"===b.type&&this.unboundPorts[b.id]?(this.unboundPorts[b.id].callback(void 0,b.error),delete this.unboundPorts[b.id]):"default"===a&&"manifest"===b.type?(this.emit("manifest",b),this.updateManifest(b.name,b.manifest)):"default"===a&&"Connection"===b.type&&(b.api&&this.providers[b.api]?this.manager.createLink(this.providers[b.api],b.channel,this.port,b.channel):!this.defaultPort||b.api!==this.defaultPort.api&&b.api?this.once("start",this.onMessage.bind(this,a,b)):this.manager.createLink(this.defaultPort,b.channel,this.port,b.channel));else{this.port=this.manager.hub.getDestination(b.channel),this.externalChannel=b.channel,this.appId=b.appId,this.lineage=b.lineage;var c=this.mapProxies(b.manifest);this.generateEnv(b.manifest,c).then(function(){return this.loadLinks(c)}.bind(this)).then(this.loadScripts.bind(this,b.id,b.manifest.app.script)).then(null,function(a){this.debug.error("Could not set up module "+this.appId+": ",a)}.bind(this))}},h.prototype.toString=function(){return"[Environment Helper]"},h.prototype.generateEnv=function(a,b){return this.binder.bindDefault(this.port,this.api,a,!0).then(function(a){var c=0;if(a.port.api=a.external.api,this.defaultPort=a.port,a.external.api)for(c=0;c<b.length;c+=1)if(b[c].name===a.external.api&&b[c].def.provides){b.splice(c,1);break}this.config.global.freedom=a.external}.bind(this))},h.prototype.registerId=function(a,b){var c=g.getId();return this.unboundPorts[c]={name:a,callback:b},c},h.prototype.attach=function(a,b,c){var d=this.config.global.freedom;return b&&(this.providers[a]=c.port),d[a]||(d[a]=c.external,this.manifests[a]&&(d[a].manifest=this.manifests[a])),this.pendingPorts-=1,0===this.pendingPorts&&this.emit("start"),d[a]},h.prototype.loadLinks=function(a){var b,c,f,h=function(a,b,c){return"manifest"===b&&c.name===a},i=function(a,b){var c={name:a.api};b.manifest.api&&b.manifest.api[a.api]?c.definition=b.manifest.api[a.api]:c.definition=null,this.binder.getExternal(this.port,a.name,c).then(this.attach.bind(this,a.name,!1))}.bind(this),j=new d(function(a,b){this.once("start",a)}.bind(this));for(b=0;b<a.length;b+=1)a[b].api&&!a[b].def?this.manifests[a[b].name]?i(a[b],{manifest:this.manifests[a[b].name]}):this.once(h.bind({},a[b].name),i.bind(this,a[b])):this.binder.getExternal(this.port,a[b].name,a[b].def).then(this.attach.bind(this,a[b].name,a[b].def&&a[b].def.provides)),this.pendingPorts+=1;return this.manager.resource.addResolver(function(a,b,c){var d=g.getId();return this.requests[d]=c,this.emit(this.externalChannel,{type:"resolve",id:d,data:b}),!0}.bind(this)),this.pendingPorts+=1,f=this.api.get("core").definition,c=new e(f,this.debug),this.manager.getCore(function(a){new a(this.manager).setId(this.lineage,this),c.getInterface().provideAsynchronous(a)}.bind(this)),this.emit(this.controlChannel,{type:"Link to core",request:"link",name:"core",to:c}),this.binder.getExternal(c,"default",{name:"core",definition:f}).then(function(a){a.external.getLoggerSync=this.debug.getLoggingShim(a.external().getLogger),this.attach("core",!1,a)}.bind(this)),0===this.pendingPorts&&this.emit("start"),j},h.prototype.updateManifest=function(a,b){var c=this.config.global.freedom;c&&c[a]?c[a].manifest=b:this.unboundPorts[a]?this.binder.getExternal(this.port,a,this.binder.getAPI(b,this.api,this.unboundPorts[a].api)).then(this.attach.bind(this,a,!1)).then(function(b){this.unboundPorts[a].callback(b),delete this.unboundPorts[a]}.bind(this)):this.manifests[a]=b},h.prototype.mapProxies=function(a){var b,c,d=[],e=["core"];if(a.permissions)for(b=0;b<a.permissions.length;b+=1)c={name:a.permissions[b],def:void 0},c.def=this.api.get(c.name),e.indexOf(c.name)<0&&c.def&&(d.push(c),e.push(c.name));if(a.dependencies&&g.eachProp(a.dependencies,function(a,b){c={name:b,api:a.api},e.indexOf(b)<0&&(a.api&&(c.def=this.api.get(a.api)),d.push(c),e.push(b))}.bind(this)),a.provides)for(b=0;b<a.provides.length;b+=1){if(c={name:a.provides[b],def:void 0},c.def=this.api.get(c.name),c.def)c.def.provides=!0;else{if(!a.api||!a.api[c.name]){this.debug.warn('Module will not provide "'+c.name+'", since no declaration can be found.');continue}c.def={name:c.name,definition:a.api[c.name],provides:!0}}e.indexOf(c.name)<0&&(d.push(c),e.push(c.name))}return d},h.prototype.loadScripts=function(a,b){var c,d,e=function(a,b,c){try{this.config.global.importScripts(a),b(!0)}catch(d){c(d)}}.bind(this);c="string"==typeof b?1:b.length,d=function(f){if(f===c)return void this.emit(this.externalChannel,{type:"ready"});var g;g="string"==typeof b?b:b[f],this.manager.resource.get(a,g).then(function(a){this.tryLoad(e,a).then(function(){d(f+1)}.bind(this))}.bind(this))}.bind(this),this.config.global.importScripts||(e=function(a,b,c){var d=this.config.global.document.createElement("script");d.src=a,d.addEventListener("load",b,!0),this.config.global.document.body.appendChild(d)}.bind(this)),d(0)},h.prototype.tryLoad=function(a,b){return new d(a.bind({},b)).then(function(a){return a},function(a){this.debug.warn(a.stack),this.debug.error("Error loading "+b,a),this.debug.error("If the stack trace is not useful, see https://github.com/freedomjs/freedom/wiki/Debugging")}.bind(this))},b.exports=h},{"./provider":31,"./proxy/apiInterface":32,"./proxybinder":34,"./util":36,"es6-promise":2}],30:[function(a,b,c){var d=a("es6-promise").Promise,e=a("./module"),f=a("./util"),g=function(a,b,c){this.api=a.api,this.debug=a.debug,this.location=c.location,this.resource=b,this.config=c,this.runtimes=[],this.policies=[],this.pending={},f.handleEvents(this),this.add(a,c.policy),this.runtimes[0].local=!0};g.prototype.defaultPolicy={background:!1,interactive:!0},g.prototype.defaultConstraints={isolation:"always",placement:"local"},g.prototype.get=function(a,b){return this.pending[b]?new d(function(c,d){this.once("placed",function(a,b){this.get(a,b).then(c,d)}.bind(this,a,b))}.bind(this)):(this.pending[b]=!0,this.loadManifest(b).then(function(c){var d,f=this.overlay(this.defaultConstraints,c.constraints),g=this.findDestination(a,b,f);return g.local?(d=this.isRunning(g,b,a,"never"!==f.isolation),"always"!==f.isolation&&d?(this.debug.info("Reused port "+d),delete this.pending[b],this.emit("placed"),g.manager.getPort(d)):new e(b,c,a,this)):(this.debug.error("Unexpected location selected for module placement"),!1)}.bind(this),function(a){throw this.debug.error("Policy Error Resolving "+b,a),a}.bind(this)))},g.prototype.findDestination=function(a,b,c){var d;if("always"!==c.isolation)for(d=0;d<this.policies.length;d+=1)if(this.isRunning(this.runtimes[d],b,a,"never"!==c.isolation))return this.runtimes[d];if("local"===c.placement)return this.runtimes[0];if("stable"===c.placement)for(d=0;d<this.policies.length;d+=1)if(this.policies[d].background)return this.runtimes[d];return this.runtimes[0]},g.prototype.isRunning=function(a,b,c,d){var e,f=0,g=0;for(f=0;f<a.modules.length;f+=1)if(d&&a.modules[f].length===c.length+1){for(e=!0,g=0;g<c.length;g+=1)if(0!==a.modules[f][g+1].indexOf(c[g])){e=!1;break}if(0!==a.modules[f][0].indexOf(b)&&(e=!1),e)return a.modules[f][0]}else if(!d&&0===a.modules[f][0].indexOf(b))return a.modules[f][0];return!1},g.prototype.loadManifest=function(a){return this.resource.getContents(a).then(function(b){try{return JSON.parse(b)}catch(c){throw this.debug.error("Failed to load "+a+": "+c),new Error("No Manifest Available")}}.bind(this))},g.prototype.add=function(a,b){var c={manager:a,modules:[]};this.runtimes.push(c),this.policies.push(this.overlay(this.defaultPolicy,b)),a.on("moduleAdd",function(a,b){var c=[];c=c.concat(b.lineage),c[0]=b.id,a.modules.push(c),this.pending[b.lineage[0]]&&(delete this.pending[b.lineage[0]],this.emit("placed"))}.bind(this,c)),a.on("moduleRemove",function(a,b){var c,d,e=[];for(e=e.concat(b.lineage),e[0]=b.id,d=e.toString(),c=0;c<a.modules.length;c+=1)if(a.modules[c].toString()===d)return void a.modules.splice(c,1);this.debug.warn("Unknown module to remove: ",b.id)}.bind(this,c))},g.prototype.overlay=function(a,b){var c={};return f.mixin(c,a),b&&f.mixin(c,b,!0),c},b.exports=g},{"./module":28,"./util":36,"es6-promise":2}],31:[function(a,b,c){var d=a("./consumer"),e=a("./util"),f=function(a,b){this.id=d.nextId(),e.handleEvents(this),this.debug=b,this.definition=a,this.mode=f.mode.synchronous,this.channels={},this.iface=null,this.closeHandlers={},this.providerCls=null,this.ifaces={},this.emits={}};f.mode={synchronous:0,asynchronous:1,promises:2},f.prototype.onMessage=function(a,b){if("control"===a&&b.reverse)this.channels[b.name]=b.channel,this.emit(b.channel,{type:"channel announcement",channel:b.reverse}),this.emit("start");else if("control"===a&&"setup"===b.type)this.controlChannel=b.channel;else if("control"===a&&"close"===b.type)b.channel===this.controlChannel&&delete this.controlChannel,this.close();else{if(!this.channels[a]&&b.channel)return this.channels[a]=b.channel,void this.emit("start");if(!this.channels[a])return void this.debug.warn("Message from unconfigured source: "+a);if("close"===b.type&&b.to)this.teardown(a,b.to);else if(b.to&&this.emits[a]&&this.emits[a][b.to])b.message.to=b.to,this.emits[a][b.to](b.message);else if(b.to&&b.message&&"construct"===b.message.type){var c,e=d.portableToMessage(this.definition.constructor&&this.definition.constructor.value?this.definition.constructor.value:[],b.message,this.debug);this.ifaces[a]||(this.ifaces[a]={},this.emits[a]={}),this.ifaces[a][b.to]=!0,c=this.getProvider(a,b.to,e),this.ifaces[a]&&this.ifaces[a][b.to]&&(this.ifaces[a][b.to]=c.instance,this.emits[a][b.to]=c.onmsg)}else this.debug.warn(this.toString()+" dropping message "+JSON.stringify(b))}},f.prototype.close=function(){this.controlChannel&&(this.emit(this.controlChannel,{type:"Provider Closing",request:"close"}),delete this.controlChannel),this.emit("close"),delete this.iface,delete this.providerCls,this.ifaces={},this.emits={},this.emitChannel=null},f.prototype.teardown=function(a,b){this.ifaces[a]&&(delete this.ifaces[a][b],delete this.emits[a][b],this.closeHandlers[a]&&this.closeHandlers[a][b]&&(e.eachProp(this.closeHandlers[a][b],function(a){a()}),delete this.closeHandlers[a][b]))},f.prototype.getInterface=function(){if(this.iface)return this.iface;var a=function(a){if("function"!=typeof a)throw new Error("Provider "+this.toString()+" needs to be implemented by a function.")};return this.iface={provideSynchronous:function(b){a(b),this.providerCls=b,this.mode=f.mode.synchronous}.bind(this),provideAsynchronous:function(b){a(b),this.providerCls=b,this.mode=f.mode.asynchronous}.bind(this),providePromises:function(b){a(b),this.providerCls=b,this.mode=f.mode.promises}.bind(this)},e.eachProp(this.definition,function(a,b){switch(a.type){case"constant":Object.defineProperty(this.iface,b,{value:d.recursiveFreezeObject(a.value),writable:!1})}}.bind(this)),this.iface},f.prototype.getProxyInterface=function(){var a=function(a){return a.getInterface()}.bind({},this);return a.close=function(a){a?e.eachProp(this.ifaces,function(b,c){e.eachProp(b,function(b,d){return b===a?(this.teardown(c,d),this.emit(this.channels[c],{type:"close",to:d}),!0):void 0}.bind(this))}.bind(this)):this.close()}.bind(this),a.onClose=function(a,b){return"function"==typeof a&&void 0===b?void this.once("close",a):void e.eachProp(this.ifaces,function(c,d){e.eachProp(c,function(c,e){return c===a?(this.closeHandlers[d]||(this.closeHandlers[d]={}),this.closeHandlers[d][e]||(this.closeHandlers[d][e]=[]),this.closeHandlers[d][e].push(b),!0):void 0}.bind(this))}.bind(this))}.bind(this),a},f.prototype.getProvider=function(a,b,c){
if(!this.providerCls)return this.debug.error("Cannot instantiate provider, since it is not provided"),{instance:void 0,onmsg:void 0};var g,h,i,j={};return e.eachProp(this.definition,function(a,b){"event"===a.type&&(j[b]=a)}),g=function(a,b,c,e,f){if(b[e]){var g=d.messageToPortable(b[e].value,f,this.debug);this.emit(this.channels[a],{type:"message",to:c,message:{name:e,type:"event",text:g.text,binary:g.binary}})}}.bind(this,a,j,b),h=this.providerCls.bind.apply(this.providerCls,[this.providerCls,g].concat(c||[])),i=new h,{instance:i,onmsg:function(a,b,c){var e,g,h,j,k;if("method"===c.action){if("function"!=typeof this[c.type])return a.debug.warn("Provider does not implement "+c.type+"()!"),void a.emit(a.channels[b],{type:"method",to:c.to,message:{to:c.to,type:"method",reqId:c.reqId,name:c.type,error:"Provider does not implement "+c.type+"()!"}});if(e=a.definition[c.type],g=a.debug,h=d.portableToMessage(e.value,c,g),k=null===c.reqId?function(a,b){b&&g.error(b)}:function(a,b,c,e,f){var h=d.messageToPortable(c.ret,e,g);this.emit(this.channels[a],{type:"method",to:b.to,message:{to:b.to,type:"method",reqId:b.reqId,name:b.type,text:h.text,binary:h.binary,error:f}})}.bind(a,b,c,e),Array.isArray(h)||(h=[h]),a.mode===f.mode.synchronous)try{k(this[c.type].apply(this,h))}catch(l){k(void 0,l.message+" "+l.stack)}else if(a.mode===f.mode.asynchronous)try{this[c.type].apply(i,h.concat(k))}catch(m){k(void 0,m.message+" "+m.stack)}else if(a.mode===f.mode.promises)try{j=this[c.type].apply(this,h),j&&j.then?j.then(k,k.bind({},void 0)):k(void 0,"No promise returned from "+c.type+": "+j)}catch(n){k(void 0,n.message+" "+n.stack)}}}.bind(i,this,a)}},f.prototype.toString=function(){return this.emitChannel?"[Provider "+this.emitChannel+"]":"[unbound Provider]"},b.exports=f},{"./consumer":21,"./util":36}],32:[function(a,b,c){var d=a("es6-promise").Promise,e=a("../util"),f=a("../consumer"),g=function(a,b,c,g){var h={},i=null,j=null,k=0,l=arguments;e.eachProp(a,function(a,b){switch(a.type){case"method":this[b]=function(){var e=k,i=new d(function(b,c){h[e]={resolve:b,reject:c,template:a.ret}}),j=f.messageToPortable(a.value,Array.prototype.slice.call(arguments,0),g);return k+=1,c({action:"method",type:b,reqId:e,text:j.text,binary:j.binary}),i},this[b].reckless=function(){var d=f.messageToPortable(a.value,Array.prototype.slice.call(arguments,0),g);c({action:"method",type:b,reqId:null,text:d.text,binary:d.binary})};break;case"event":i||(e.handleEvents(this),j=this.emit,delete this.emit,i={}),i[b]=a;break;case"constant":Object.defineProperty(this,b,{value:f.recursiveFreezeObject(a.value),writable:!1})}}.bind(this)),b(this,function(a,b){if("close"===a)return this.off&&this.off(),e.eachProp(h,function(a){a.reject("closed")}),void(h={});if(b)if("method"===b.type)if(h[b.reqId]){var c=h[b.reqId],d=c.template;delete h[b.reqId],b.error?c.reject(b.error):c.resolve(f.portableToMessage(d,b,g))}else g.error("Incoming message claimed to be an RPC returning for unregistered call",b.reqId);else"event"===b.type&&i[b.name]&&j(b.name,f.portableToMessage(i[b.name].value,b,g))}.bind(this)),l=f.messageToPortable(a.constructor&&a.constructor.value?a.constructor.value:[],Array.prototype.slice.call(l,4),g),c({type:"construct",text:l.text,binary:l.binary})};b.exports=g},{"../consumer":21,"../util":36,"es6-promise":2}],33:[function(a,b,c){var d=a("../util"),e=function(a,b,c){d.handleEvents(this),a(this,function(a,b,c){"close"!==b&&a(c.type,c.message)}.bind(this,this.emit)),this.emit=function(a,b,c){a({type:b,message:c},!0)}.bind({},b)};b.exports=e},{"../util":36}],34:[function(a,b,c){var d=a("es6-promise").Promise,e=a("./proxy/apiInterface"),f=a("./proxy/eventInterface"),g=a("./consumer"),h=a("./provider"),i=function(a){"use strict";this.manager=a};i.prototype.getExternal=function(a,b,c){"use strict";var i,j;return new d(function(d,k){c?(j=c.name,i=c.provides?new h(c.definition,this.manager.debug):new g(e.bind({},c.definition),this.manager.debug)):i=new g(f,this.manager.debug),i.once("start",function(){var a=i.getProxyInterface();j&&(a.api=j),d({port:i,external:a})}),this.manager.createLink(a,b,i)}.bind(this))},i.prototype.bindDefault=function(a,b,c,d){"use strict";var e,f={name:c.name,icon:c.icon,description:c.description};return c["default"]&&(e=b.get(c["default"]),!e&&c.api&&c.api[c["default"]]&&(e={name:c["default"],definition:c.api[c["default"]]}),d&&c.provides&&c.provides.indexOf(c["default"])!==!1?e.provides=!0:d&&b.debug.warn("default API not provided, are you missing a provides key in your manifest?")),this.getExternal(a,"default",e).then(function(a,b){return b.external.manifest=a,b}.bind(this,f))},i.prototype.getAPI=function(a,b,c){"use strict";if(a.api&&a.api[c])return{name:c,definition:a.api[c]};if(a["default"]){var d=b.get(a["default"]);return!d&&a.api&&a.api[a["default"]]?{name:a["default"],definition:a.api[a["default"]]}:d}return!1},b.exports=i},{"./consumer":21,"./provider":31,"./proxy/apiInterface":32,"./proxy/eventInterface":33,"es6-promise":2}],35:[function(a,b,c){var d=a("es6-promise").Promise,e=a("./util"),f=function(a){this.debug=a,this.files={},this.resolvers=[this.httpResolver,this.nullResolver],this.contentRetrievers={http:this.xhrRetriever,https:this.xhrRetriever,"chrome-extension":this.xhrRetriever,resource:this.xhrRetriever,chrome:this.xhrRetriever,app:this.xhrRetriever,gopher:this.xhrRetriever,manifest:this.manifestRetriever}};f.prototype.get=function(a,b){var c=JSON.stringify([a,b]);return new d(function(d,e){this.files[c]?d(this.files[c]):this.resolve(a,b).then(function(a,b,c){this.files[a]=c,b(c)}.bind(this,c,d),e)}.bind(this))},f.prototype.getContents=function(a){return new d(function(b,c){var d;if(!a)return this.debug.warn("Asked to get contents of undefined URL."),c();for(d in this.contentRetrievers)if(this.contentRetrievers.hasOwnProperty(d)){if(0===a.indexOf(d+"://"))return this.contentRetrievers[d].call(this,a,b,c);if(-1===a.indexOf("://")&&"null"===d)return this.contentRetrievers[d].call(this,a,b,c)}c()}.bind(this))};var g=function(a){return new d(function(b,c){var d=[];a.forEach(function(e){e.then(b,function(b){d.push(b),d.length===a.length&&c(d)})})})};f.prototype.resolve=function(a,b){return new d(function(c,f){var h=[];return void 0===b?f():(e.eachReverse(this.resolvers,function(c){h.push(new d(c.bind({},a,b)))}.bind(this)),void g(h).then(c,function(){f("No resolvers to handle url: "+JSON.stringify([a,b]))}))}.bind(this))},f.prototype.addResolver=function(a){this.resolvers.push(a)},f.prototype.addRetriever=function(a,b){return this.contentRetrievers[a]?void this.debug.warn("Unwilling to override file retrieval for "+a):void(this.contentRetrievers[a]=b)},f.prototype.register=function(a){a.length&&a.forEach(function(a){a.resolver?this.addResolver(a.resolver):a.proto&&a.retriever&&this.addRetriever(a.proto,a.retriever)}.bind(this))},f.hasScheme=function(a,b){var c;for(c=0;c<a.length;c+=1)if(0===b.indexOf(a[c]+"://"))return!0;return!1},f.removeRelativePath=function(a){var b,c,d,e=a.indexOf("://")+3;for(a=a.replace(/\/\.\//g,"/");"/"===a.charAt(e);)a=a.slice(0,e)+a.slice(e+1,a.length);for(e=a.indexOf("/",e),b=a.substr(e+1).split("/");-1!==b.indexOf("..");)c=b.indexOf(".."),0===c?b.shift():b.splice(c-1,2);for(d=a.substr(0,e),e=0;e<b.length;e+=1)d+="/"+b[e];return d},f.prototype.httpResolver=function(a,b,c,d){var e,g,h,i,j,k=["http","https","chrome","chrome-extension","resource","app","gopher"];return f.hasScheme(k,b)?(c(f.removeRelativePath(b)),!0):a?f.hasScheme(k,a)&&-1===b.indexOf("://")?(e=a.substr(0,a.lastIndexOf("/")),g=e.indexOf("://"),h=g+3+e.substr(g+3).indexOf("/"),i=e.substr(h),j=e.substr(0,h),c(0===b.indexOf("/")?f.removeRelativePath(j+b):f.removeRelativePath(j+i+"/"+b)),!0):void d():(d(),!1)},f.prototype.nullResolver=function(a,b,c,d){var e=["manifest"];return f.hasScheme(e,b)?(c(b),!0):0===b.indexOf("data:")?(c(b),!0):void d()},f.prototype.manifestRetriever=function(a,b,c){var d;try{d=a.substr(11),JSON.parse(d),b(d)}catch(e){this.debug.warn("Invalid manifest URL referenced:"+a),c()}},f.prototype.xhrRetriever=function(a,b,c){var d=new XMLHttpRequest;d.addEventListener("readystatechange",function(b,c){4===d.readyState&&d.responseText?b(d.responseText):4===d.readyState&&(this.debug.warn("Failed to load file "+a+": "+d.status),c(d.status))}.bind(this,b,c),!1),d.overrideMimeType("application/json"),d.open("GET",a,!0),d.send()},b.exports=f},{"./util":36,"es6-promise":2}],36:[function(a,b,c){var d={};d.eachReverse=function(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}},d.hasProp=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},d.eachProp=function(a,b){var c;for(c in a)if(a.hasOwnProperty(c)&&b(a[c],c))break},d.mixin=function(a,b,c){return b&&d.eachProp(b,function(b,e){(c||!d.hasProp(a,e))&&(a[e]=b)}),a},d.getId=function(){var a,b="guid",c=12;if("object"==typeof crypto&&crypto.getRandomValues)a=new Uint8Array(c),crypto.getRandomValues(a),d.eachReverse(a,function(a){b+="-"+a});else if("object"==typeof crypto&&crypto.randomBytes)a=crypto.randomBytes(c),d.eachReverse(a,function(a){b+="-"+a});else for(;c>0;)b+="-"+Math.ceil(255*Math.random()),c-=1;return b},d.str2ab=function(a){var b,c=a.length,d=new ArrayBuffer(2*c),e=new Uint16Array(d);for(b=0;c>b;b+=1)e[b]=a.charCodeAt(b);return d},d.ab2str=function(a){return String.fromCharCode.apply(null,new Uint16Array(a))},d.handleEvents=function(a){var b,c,d={DEBUG_BACKREF:a,multiple:{},maybemultiple:[],single:{},maybesingle:[]};b=function(a,b){var c,d=[];if(!a||!a.length)return[];for(c=a.length-1;c>=0;c-=1)b(a[c])&&d.push(a.splice(c,1));return d},c=function(a,b,c){"function"==typeof b?this["maybe"+a].push([b,c]):this[a][b]?this[a][b].push(c):this[a][b]=[c]},a.on=c.bind(d,"multiple"),a.once=c.bind(d,"single"),a.emit=function(a,b){var c,d;for(c=0;this.multiple[a]&&c<this.multiple[a].length;c+=1)if(this.multiple[a][c](b)===!1)return;if(this.single[a])for(d=this.single[a],this.single[a]=[],c=0;c<d.length;c+=1)d[c](b);for(c=0;c<this.maybemultiple.length;c+=1)this.maybemultiple[c][0](a,b)&&this.maybemultiple[c][1](b);for(c=this.maybesingle.length-1;c>=0;c-=1)this.maybesingle[c][0](a,b)&&(d=this.maybesingle.splice(c,1),d[0][1](b))}.bind(d),a.off=function(a,c){return a?("function"==typeof a&&(b(this.maybesingle,function(b){return b[0]===a&&(!c||b[1]===c)}),b(this.maybemultiple,function(b){return b[0]===a&&(!c||b[1]===c)})),void(c?(b(this.multiple[a],function(a){return a===c}),b(this.single[a],function(a){return a===c})):(delete this.multiple[a],delete this.single[a]))):(delete this.DEBUG_BACKREF,this.multiple={},this.maybemultiple=[],this.single={},void(this.maybesingle=[]))}.bind(d)},d.isModuleContext=function(){return"undefined"==typeof document},d.getBlob=function(a,b){if("function"!=typeof Blob&&"undefined"!=typeof WebKitBlobBuilder){var c=new WebKitBlobBuilder;return c.append(a),c.getBlob(b)}return new Blob([a],{type:b})},d.scripts=function(a){return a.document.getElementsByTagName("script")},b.exports=d},{}],37:[function(a,b,c){(function(b){function c(){"use strict";var a;return window.document.currentScript?a=window.document.currentScript.src:"complete"!==document.readyState&&"loaded"!==document.readyState?(a=window.document.getElementsByTagName("script"),a=a[a.length-1].src):(a=document.querySelector("script[src*='freedom.js'],script[src*='freedom-']"),1!==a.length&&console.error("Could not determine freedom.js script tag."),a=a[0].src),a}var d=[a("../../providers/core/core.unprivileged"),a("../../providers/core/core.echo"),a("../../providers/core/core.console"),a("../../providers/core/core.crypto"),a("../../providers/core/core.peerconnection"),a("../../providers/core/core.rtcpeerconnection"),a("../../providers/core/core.rtcdatachannel"),a("../../providers/core/core.storage"),a("../../providers/core/core.view"),a("../../providers/core/core.oauth"),a("../../providers/core/core.websocket"),a("../../providers/core/core.xhr")];"undefined"!=typeof window?window.freedom=a("../entry").bind({},{location:window.location.href,portType:a("../link/worker"),source:c(),providers:d,oauth:[a("../../providers/oauth/oauth.localpageauth"),a("../../providers/oauth/oauth.remotepageauth")]}):a("../entry")({isModule:!0,portType:a("../link/worker"),providers:d,global:b})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../providers/core/core.console":5,"../../providers/core/core.crypto":6,"../../providers/core/core.echo":7,"../../providers/core/core.oauth":8,"../../providers/core/core.peerconnection":9,"../../providers/core/core.rtcdatachannel":10,"../../providers/core/core.rtcpeerconnection":11,"../../providers/core/core.storage":12,"../../providers/core/core.unprivileged":13,"../../providers/core/core.view":14,"../../providers/core/core.websocket":15,"../../providers/core/core.xhr":16,"../../providers/oauth/oauth.localpageauth":17,"../../providers/oauth/oauth.remotepageauth":18,"../entry":23,"../link/worker":26}]},{},[37]);
//
//# sourceMappingURL=freedom.min.js.map